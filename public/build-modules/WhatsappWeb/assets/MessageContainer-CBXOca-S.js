import{c as j,o as O,D as lt,E as ct,G as ft,p as Se,H as q,y as ht,k as Ie,l as pt,I as mt,r as tt,b as D,t as se,a as W,f as Y,u as P,i as Ne,J as vt,m as gt,F as bt,g as yt,e as Xe,K as wt,d as Ge,h as Rt,L as Pe,w as kt,M as xt,n as Ct}from"./app-BPxwetsb.js";import{h as Ze}from"./moment-BAtM24Ew.js";import{a as St,_ as Tt}from"./IntersectionObserver-D-rwMhVF.js";import{e as Mt}from"./echoServiceComposable-DU9yHR3K.js";import{t as He}from"./toastComposable-BZSSJ7BC.js";import{u as je}from"./modalStore-CB1x_O57.js";import{_ as Lt}from"./SpinnerBtn-CfgwDcW3.js";import{u as At}from"./assetStore-W3D4A6Yl.js";import{u as Dt}from"./chatStore-BmGZKHrH.js";import It from"./Header-zfPyx5s_.js";import Ut from"./MediaPreview-g_w6JAEC.js";import Bt from"./MessagePreview-BjWtOddu.js";import Ft from"./QuickReplyPreview-N23d0bgv.js";import _t from"./ReplyPreview-HgffEWxI.js";import"./PollPreview-BsmgxXjz.js";import"./LocationPreview-BGpMszWs.js";const Ot={},Et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",style:{margin:"auto",display:"block"},width:"35px",height:"35px",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"};function Pt(h,a){return O(),j("svg",Et,a[0]||(a[0]=[lt('<circle cx="84" cy="50" r="10" fill="#e15b64"><animate attributeName="r" repeatCount="indefinite" dur="0.25s" calcMode="spline" keyTimes="0;1" values="10;0" keySplines="0 0.5 0.5 1" begin="0s"></animate><animate attributeName="fill" repeatCount="indefinite" dur="1s" calcMode="discrete" keyTimes="0;0.25;0.5;0.75;1" values="#e15b64;#abbd81;#f8b26a;#f47e60;#e15b64" begin="0s"></animate></circle><circle cx="16" cy="50" r="10" fill="#e15b64"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="0s"></animate></circle><circle cx="50" cy="50" r="10" fill="#f47e60"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.25s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.25s"></animate></circle><circle cx="84" cy="50" r="10" fill="#f8b26a"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.5s"></animate></circle><circle cx="16" cy="50" r="10" fill="#abbd81"><animate attributeName="r" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="0;0;10;10;10" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.75s"></animate><animate attributeName="cx" repeatCount="indefinite" dur="1s" calcMode="spline" keyTimes="0;0.25;0.5;0.75;1" values="16;16;16;50;84" keySplines="0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1;0 0.5 0.5 1" begin="-0.75s"></animate></circle>',5)]))}const jt=St(Ot,[["render",Pt]]),Nt=ct("chatStore",{state:()=>({features:{voice_message:!0},platform:null,leftSidebar:{isOpen:!0},searchedConversationList:[],conversations:[],chatTemplates:[],quickReplies:[],aiTemplates:[],badges:[],activeConversationId:null,rightSidebar:{isOpen:!1},assetPopup:!1,messageInputFieldRef:null,chatSearchInput:"",chatSearchInputRef:null,chatSearchedItems:[],replying:{},searchForm:{badge_id:null,customer_name:"",assigned_to:null},loading:{sendingMessage:!1,messages:!1,conversations:!1,searching:!1,message_searching:!1},inputMessage:{conversation_id:null,type:"text",message:"",caption:"",attachments:[],template:null,context:null},arrowCounter:0,quickReplySearchInput:"",quickReplySuggestionItemsShow:!1,quickReplyModalIsOpen:!1,quickReplyModalSearchInput:null}),getters:{filteredConversations(){return this.searchForm.customer_name.length>0||this.searchForm.badge_id||this.searchForm.assigned_to?this.searchedConversationList:this.conversations},hasConversations(){return this.conversations.length>0},hasActiveConversation(){return this.activeConversationId!==null},activeConversation(){return this.conversations.find(h=>h.id===this.activeConversationId)??{}},activeConversationMessages(){const h=this.activeConversation.messages??[];return h.length?h.slice().reverse():[]},isReplying(){return this.replying.message_id},getActiveModuleName(){var h,a;return(((h=this.activeConversation)==null?void 0:h.module)??"").charAt(0).toUpperCase()+(((a=this.activeConversation)==null?void 0:a.module)??"").slice(1)},quickReplyFilteredItems(){var p;let h=((p=this.activeConversation)==null?void 0:p.module)??"",a=this.quickReplies;return this.quickReplySearchInput.length>0&&(a=a.filter(F=>F.message_template.toLowerCase().includes(this.quickReplySearchInput.toLowerCase()))),a.filter(F=>F.module===h).map(F=>F.message_template)},quickReplySuggestionItems(){var p,F;let h=((p=this.activeConversation)==null?void 0:p.module)??"",a=[];return((F=this.inputMessage.message)==null?void 0:F.length)>0&&(a=this.quickReplies.filter(A=>{var _;return A.message_template.toLowerCase().includes((_=this.inputMessage.message)==null?void 0:_.toLowerCase())})),a.filter(A=>A.module===h).map(A=>A.message_template)},getActiveModuleTemplates(){return this.chatTemplates.filter(h=>h.module==this.activeConversation.module)}},actions:{downloadAttachment(h,a){Se.post(route("user.messages.download-attachment",h),a).then(p=>{console.log(p)})},getBadge(h){return this.badges.find(a=>a.id===h)??null},async getChatSearchedItems(){var h,a;if(this.chatSearchInput.length===0){this.chatSearchedItems=[];return}try{this.loading.message_searching=!0;const p=await Se.get(route("user.conversations.api","messages"),{params:{module:(h=this.platform)==null?void 0:h.module,conversation_id:this.activeConversationId,search:this.chatSearchInput}});this.chatSearchedItems=((a=p.data)==null?void 0:a.data)??[]}catch(p){console.error(p)}finally{this.loading.message_searching=!1}},setActiveConversation(h){this.activeConversationId=h,this.activeConversation.unread_count=0},toggleRightSidebar(){this.rightSidebar.isOpen=!this.rightSidebar.isOpen},scrollToLastMessage(h="smooth"){setTimeout(()=>{let a=document.querySelector("#scrollContainerRef");a&&a.scrollIntoView({block:"end",behavior:h})},300)},setReplying(h){var a,p;this.replying={message_id:h.uuid,message:((a=h.body)==null?void 0:a.text)??((p=h.body)==null?void 0:p.caption)??h.type??""}},unsetReplying(){this.replying={}},touchConversation(h){h.updated_at=new Date().toISOString()},shortConversations(){this.conversations.sort((h,a)=>new Date(a.updated_at)-new Date(h.updated_at))},loadMoreMessages(h){var a;console.log("loading more messages"),!this.loading.messages&&(this.loading.messages=!0,Se.get(route("user.conversations.api","load_more_messages"),{params:{module:(a=this.platform)==null?void 0:a.module,conversation_id:h??this.activeConversationId,limit:10,last_message_id:h?0:this.activeConversationMessages[0].id}}).then(p=>{let F=!1;if(p.data.length===0){if(F=!0,F){let A=this.conversations.find(_=>_.id==this.activeConversationId);A&&(A.no_more_messages=!0)}return}this.conversations=this.conversations.map(A=>(A.id==this.activeConversationId&&p.data.forEach((_,E)=>{A.messages.push(_)}),A))}).catch(p=>console.error(p)).finally(()=>{this.loading.messages=!1}))},loadMoreConversations(){var h;console.log("load more conversations"),!this.loading.conversations&&(this.loading.conversations=!0,Se.get(route("user.conversations.api","load_more_conversations"),{params:{module:(h=this.platform)==null?void 0:h.module,limit:10,last_conversation_id:this.conversations.length>0?this.conversations[0].id:null}}).then(a=>{if(a.data.length===0){console.log("no more conversations");return}let p=[];a.data.forEach(F=>{p.find(A=>A.id==F.id)||p.push(F)})}).catch(a=>console.error(a)).finally(()=>this.loading.conversations=!1))},async loadBadges(){try{const h=await Se.get(route("user.conversations.api","badges"));this.badges=h.data}catch(h){console.error(h)}},async submitMessage(){var a,p,F,A;let h={conversation_id:this.activeConversationId??null,reply_message_uuid:((a=this.replying)==null?void 0:a.message_id)??null,type:this.inputMessage.type??"text",text:this.inputMessage.message??null,caption:this.inputMessage.caption??null,template:this.inputMessage.template??null,attachments:this.inputMessage.attachments??[]};try{this.loading.sendingMessage=!0;const _=await Se.post(route("user.messages.store"),h,{headers:{"Content-Type":"multipart/form-data"}});this.conversations=this.conversations.map(E=>(E.id==this.activeConversationId&&E.messages.unshift(_.data),E)),this.resetInputMessage(),(p=this.messageInputFieldRef)==null||p.focus(),this.unsetReplying(),this.touchConversation(this.activeConversation),this.shortConversations()}catch(_){He.danger(((A=(F=_.response)==null?void 0:F.data)==null?void 0:A.message)||_.message||"Something went wrong!"),console.error(_)}finally{this.closeTemplateModal(),this.loading.sendingMessage=!1,this.assetPopup=!1,this.scrollToLastMessage()}},resetInputMessage(){this.inputMessage={conversation_id:null,type:"text",message:"",caption:"",template:null,attachments:[]}},closeTemplateModal(){je().close("templateModal")},onArrowDown(h){this.quickReplyModalIsOpen&&this.arrowCounter<this.quickReplyFilteredItems.length-1?this.arrowCounter=this.arrowCounter+1:this.arrowCounter<this.quickReplyFilteredItems.length-1&&(this.arrowCounter=this.arrowCounter+1)},onArrowUp(h){this.arrowCounter>0&&(this.arrowCounter=this.arrowCounter-1)},async addQuickReplyToMessageInput(h){const a=document.getElementById("inputMessageField");a.blur(),this.quickReplyModalClose(),this.inputMessage.message=this.replaceTextWithShortCodes(h)+" ",await ft(),a.focus()},replaceTextWithShortCodes(h){var p,F,A,_;let a={name:(p=this.activeConversation.customer)==null?void 0:p.name,phone:(F=this.activeConversation.customer)==null?void 0:F.uuid,username:(_=(A=this.activeConversation.customer)==null?void 0:A.meta)==null?void 0:_.username};return(h==null?void 0:h.replace(/\{([a-z_]+)\}/g,(E,ne)=>a.hasOwnProperty(ne)?a[ne]:E))??h},quickReplyModalOpen(){je().open("quickReplyModal"),this.quickReplyModalIsOpen=!0},quickReplyModalClose(){je().close("quickReplyModal"),this.quickReplyModalIsOpen=!1},selectQuickReply(h){let a="";this.quickReplyModalIsOpen?a=this.quickReplyFilteredItems[this.arrowCounter]:a=this.quickReplyFilteredItems[this.arrowCounter],this.addQuickReplyToMessageInput(a),this.arrowCounter=-1},connectWebSocket(h){var a;(a=Mt.connect())==null||a.private(h).subscribed(()=>console.log("Live chat activated successfully")).listen("IncomingNewMessageEvent",this.handleIncomingMessages).listen("IncomingMessageUpdateEvent",this.handleIncomingMessageUpdates).listen("IncomingNewConversationEvent",this.handleIncomingConversations).error(p=>console.error(p))},disconnectWebSocket(){},handleIncomingMessages(h){console.log("new message received",h),this.conversations.forEach(a=>{if(a.id===(h==null?void 0:h.conversation_id)){if(a.messages.find(F=>F.id===h.id))return console.log("message already exists");console.log("pushing new message"),a.messages.unshift(h),this.touchConversation(a),this.shortConversations(),a.unread_count+=1,this.playSound()}else console.log("conversation not found")}),this.scrollToLastMessage()},handleIncomingMessageUpdates(h){console.log("message update"),this.conversations.forEach(a=>{a.id==h.conversation_id&&a.messages.forEach(p=>{p.id==h.id&&(p.status=h.status)})})},handleIncomingConversations(h){var a;console.log("new conversation received"),this.conversations.value=this.conversations.unshift(h),this.loadMoreMessages(h.id),h.unread_count=((a=h.messages)==null?void 0:a.length)??1},playSound(){new Audio("/assets/incoming-message-beep.mp3").play()},toggleLeftSidebar(){this.leftSidebar.isOpen=!this.leftSidebar.isOpen}}});var $e={exports:{}},et;function qt(){return et||(et=1,function(h){/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a WebRTC JavaScript library for audio/video as well as screen activity recording. It supports Chrome, Firefox, Opera, Android, and Microsoft Edge. Platforms: Linux, Mac and Windows. 
 * @summary Record audio, video or screen inside the browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recorder = RecordRTC(mediaStream or [arrayOfMediaStream], {
 *     type: 'video', // audio or video or gif or canvas
 *     recorderType: MediaStreamRecorder || CanvasRecorder || StereoAudioRecorder || Etc
 * });
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, desiredSampRate: 16000, video: HTMLVideoElement, etc.}
 */function a(i,e){if(!i)throw"First parameter is required.";e=e||{type:"video"},e=new p(i,e);var t=this;function s(o){return e.disableLogs||console.log("RecordRTC version: ",t.version),o&&(e=new p(i,o)),e.disableLogs||console.log("started recording "+e.type+" stream."),m?(m.clearRecordedData(),m.record(),w("recording"),t.recordingDuration&&f(),t):(u(function(){t.recordingDuration&&f()}),t)}function u(o){o&&(e.initCallback=function(){o(),o=e.initCallback=null});var y=new F(i,e);m=new y(i,e),m.record(),w("recording"),e.disableLogs||console.log("Initialized recorderType:",m.constructor.name,"for output-type:",e.type)}function d(o){if(o=o||function(){},!m){b();return}if(t.state==="paused"){t.resumeRecording(),setTimeout(function(){d(o)},1);return}t.state!=="recording"&&!e.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',t.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),e.type!=="gif"?m.stop(y):(m.stop(),y()),w("stopped");function y(T){if(!m){typeof o.call=="function"?o.call(t,""):o("");return}Object.keys(m).forEach(function(x){typeof m[x]!="function"&&(t[x]=m[x])});var n=m.blob;if(!n)if(T)m.blob=n=T;else throw"Recording failed.";if(n&&!e.disableLogs&&console.log(n.type,"->",ye(n.size)),o){var l;try{l=z.createObjectURL(n)}catch{}typeof o.call=="function"?o.call(t,l):o(l)}e.autoWriteToDisk&&R(function(x){var S={};S[e.type+"Blob"]=x,ce.Store(S)})}}function c(){if(!m){b();return}if(t.state!=="recording"){e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",t.state);return}w("paused"),m.pause(),e.disableLogs||console.log("Paused recording.")}function r(){if(!m){b();return}if(t.state!=="paused"){e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",t.state);return}w("recording"),m.resume(),e.disableLogs||console.log("Resumed recording.")}function v(o){postMessage(new FileReaderSync().readAsDataURL(o))}function R(o,y){if(!o)throw"Pass a callback function over getDataURL.";var T=y?y.blob:(m||{}).blob;if(!T){e.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){R(o,y)},1e3);return}if(typeof Worker<"u"&&!navigator.mozGetUserMedia){var n=x(v);n.onmessage=function(S){o(S.data)},n.postMessage(T)}else{var l=new FileReader;l.readAsDataURL(T),l.onload=function(S){o(S.target.result)}}function x(S){try{var B=z.createObjectURL(new Blob([S.toString(),"this.onmessage =  function (eee) {"+S.name+"(eee.data);}"],{type:"application/javascript"})),I=new Worker(B);return z.revokeObjectURL(B),I}catch{}}}function f(o){if(o=o||0,t.state==="paused"){setTimeout(function(){f(o)},1e3);return}if(t.state!=="stopped"){if(o>=t.recordingDuration){d(t.onRecordingStopped);return}o+=1e3,setTimeout(function(){f(o)},1e3)}}function w(o){t&&(t.state=o,typeof t.onStateChanged.call=="function"?t.onStateChanged.call(t,o):t.onStateChanged(o))}var g='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function b(){e.disableLogs!==!0&&console.warn(g)}var m,M={startRecording:s,stopRecording:d,pauseRecording:c,resumeRecording:r,initRecorder:u,setRecordingDuration:function(o,y){if(typeof o>"u")throw"recordingDuration is required.";if(typeof o!="number")throw"recordingDuration must be a number.";return t.recordingDuration=o,t.onRecordingStopped=y||function(){},{onRecordingStopped:function(T){t.onRecordingStopped=T}}},clearRecordedData:function(){if(!m){b();return}m.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")},getBlob:function(){if(!m){b();return}return m.blob},getDataURL:R,toURL:function(){if(!m){b();return}return z.createObjectURL(m.blob)},getInternalRecorder:function(){return m},save:function(o){if(!m){b();return}Te(m.blob,o)},getFromDisk:function(o){if(!m){b();return}a.getFromDisk(e.type,o)},setAdvertisementArray:function(o){e.advertisement=[];for(var y=o.length,T=0;T<y;T++)e.advertisement.push({duration:T,image:o[T]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){t.state==="recording"&&!e.disableLogs&&console.warn("Stop an active recorder."),m&&typeof m.clearRecordedData=="function"&&m.clearRecordedData(),m=null,w("inactive"),t.blob=null},onStateChanged:function(o){e.disableLogs||console.log("Recorder state changed:",o)},state:"inactive",getState:function(){return t.state},destroy:function(){var o=e.disableLogs;e={disableLogs:!0},t.reset(),w("destroyed"),M=t=null,pe.AudioContextConstructor&&(pe.AudioContextConstructor.close(),pe.AudioContextConstructor=null),e.disableLogs=o,e.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return t=M,M;for(var U in M)this[U]=M[U];return t=this,M}a.version="5.6.2",h.exports=a,a.getFromDisk=function(i,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+(i==="all"?"blobs":i+" blob ")+" from disk!"),ce.Fetch(function(t,s){i!=="all"&&s===i+"Blob"&&e&&e(t),i==="all"&&e&&e(t,s.replace("Blob",""))})},a.writeToDisk=function(i){console.log("Writing recorded blob(s) to disk!"),i=i||{},i.audio&&i.video&&i.gif?i.audio.getDataURL(function(e){i.video.getDataURL(function(t){i.gif.getDataURL(function(s){ce.Store({audioBlob:e,videoBlob:t,gifBlob:s})})})}):i.audio&&i.video?i.audio.getDataURL(function(e){i.video.getDataURL(function(t){ce.Store({audioBlob:e,videoBlob:t})})}):i.audio&&i.gif?i.audio.getDataURL(function(e){i.gif.getDataURL(function(t){ce.Store({audioBlob:e,gifBlob:t})})}):i.video&&i.gif?i.video.getDataURL(function(e){i.gif.getDataURL(function(t){ce.Store({videoBlob:e,gifBlob:t})})}):i.audio?i.audio.getDataURL(function(e){ce.Store({audioBlob:e})}):i.video?i.video.getDataURL(function(e){ce.Store({videoBlob:e})}):i.gif&&i.gif.getDataURL(function(e){ce.Store({gifBlob:e})})};/**
 * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
 * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCConfiguration
 * @class
 * @example
 * var options = RecordRTCConfiguration(mediaStream, options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
 */function p(i,e){return!e.recorderType&&!e.type&&(e.audio&&e.video?e.type="video":e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===ke||e.recorderType===Re||typeof Le<"u"&&e.recorderType===Le?e.type="video":e.recorderType===Fe?e.type="gif":e.recorderType===we?e.type="audio":e.recorderType===J&&(k(i,"audio").length&&k(i,"video").length||!k(i,"audio").length&&k(i,"video").length?e.type="video":k(i,"audio").length&&!k(i,"video").length&&(e.type="audio"))),typeof J<"u"&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0]),e.bitsPerSecond),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}/**
 * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
 * @summary It returns best recorder-type available for your browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GetRecorderType
 * @class
 * @example
 * var RecorderType = GetRecorderType(options);
 * var recorder = new RecorderType(options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function F(i,e){var t;return(C||ue||he)&&(t=we),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!C&&(t=J),e.type==="video"&&(C||he)&&(t=ke,typeof Le<"u"&&typeof ReadableStream<"u"&&(t=Le)),e.type==="gif"&&(t=Fe),e.type==="canvas"&&(t=Re),le()&&t!==Re&&t!==Fe&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(k(i,"video").length||k(i,"audio").length)&&(e.type==="audio"?typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("audio/webm")&&(t=J):typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&(t=J)),i instanceof Array&&i.length&&(t=Ye),e.recorderType&&(t=e.recorderType),!e.disableLogs&&t&&t.name&&console.log("Using recorderType:",t.name||t.constructor.name),!t&&N&&(t=J),t}/**
 * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
 *     video: true, // or WhammyRecorder or MediaStreamRecorder or WebAssemblyRecorder or CanvasRecorder
 *     gif: true    // or GifRecorder
 * };
 * // mimeType is optional and should be set only in advance cases.
 * recorder.mimeType = {
 *     audio: 'audio/wav',
 *     video: 'video/webm',
 *     gif:   'image/gif'
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @requires {@link RecordRTC}
 */function A(i){this.addStream=function(e){e&&(i=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e=this.mediaType,t,s=this.mimeType||{audio:null,video:null,gif:null};if(typeof e.audio!="function"&&le()&&!k(i,"audio").length&&(e.audio=!1),typeof e.video!="function"&&le()&&!k(i,"video").length&&(e.video=!1),typeof e.gif!="function"&&le()&&!k(i,"video").length&&(e.gif=!1),!e.audio&&!e.video&&!e.gif)throw"MediaStream must have either audio or video tracks.";if(e.audio&&(t=null,typeof e.audio=="function"&&(t=e.audio),this.audioRecorder=new a(i,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:s.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),e.video||this.audioRecorder.startRecording()),e.video){t=null,typeof e.video=="function"&&(t=e.video);var u=i;if(le()&&e.audio&&typeof e.audio=="function"){var d=k(i,"video")[0];L?(u=new Q,u.addTrack(d),t&&t===ke&&(t=J)):(u=new Q,u.addTrack(d))}this.videoRecorder=new a(u,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:s.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),e.audio||this.videoRecorder.startRecording()}if(e.audio&&e.video){var c=this,r=le()===!0;(e.audio instanceof we&&e.video||e.audio!==!0&&e.video!==!0&&e.audio!==e.video)&&(r=!1),r===!0?(c.audioRecorder=null,c.videoRecorder.startRecording()):c.videoRecorder.initRecorder(function(){c.audioRecorder.initRecorder(function(){c.videoRecorder.startRecording(),c.audioRecorder.startRecording()})})}e.gif&&(t=null,typeof e.gif=="function"&&(t=e.gif),this.gifRecorder=new a(i,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:s.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){this.getBlob(function(u){u.audio&&u.video?t(u.audio,function(d){t(u.video,function(c){e({audio:d,video:c})})}):u.audio?t(u.audio,function(d){e({audio:d})}):u.video&&t(u.video,function(d){e({video:d})})});function t(u,d){if(typeof Worker<"u"){var c=s(function(R){postMessage(new FileReaderSync().readAsDataURL(R))});c.onmessage=function(v){d(v.data)},c.postMessage(u)}else{var r=new FileReader;r.readAsDataURL(u),r.onload=function(v){d(v.target.result)}}}function s(u){var d=z.createObjectURL(new Blob([u.toString(),"this.onmessage =  function (eee) {"+u.name+"(eee.data);}"],{type:"application/javascript"})),c=new Worker(d),r;if(typeof z<"u")r=z;else if(typeof webkitURL<"u")r=webkitURL;else throw"Neither URL nor webkitURL detected.";return r.revokeObjectURL(d),c}},this.writeToDisk=function(){a.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},e.audio&&this.audioRecorder&&this.audioRecorder.save(typeof e.audio=="string"?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save(typeof e.video=="string"?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save(typeof e.gif=="string"?e.gif:"")}}A.getFromDisk=a.getFromDisk,A.writeToDisk=a.writeToDisk,typeof a<"u"&&(a.MRecordRTC=A);var _="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(i){i&&(typeof window<"u"||typeof q>"u"||(q.navigator={userAgent:_,getUserMedia:function(){}},q.console||(q.console={}),(typeof q.console.log>"u"||typeof q.console.error>"u")&&(q.console.error=q.console.log=q.console.log||function(){console.log(arguments)}),typeof document>"u"&&(i.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},i.HTMLVideoElement=function(){}),typeof location>"u"&&(i.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(i.screen={width:0,height:0}),typeof z>"u"&&(i.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),i.window=q))})(typeof q<"u"?q:null);var E=window.requestAnimationFrame;if(typeof E>"u"){if(typeof webkitRequestAnimationFrame<"u")E=webkitRequestAnimationFrame;else if(typeof mozRequestAnimationFrame<"u")E=mozRequestAnimationFrame;else if(typeof msRequestAnimationFrame<"u")E=msRequestAnimationFrame;else if(typeof E>"u"){var ne=0;E=function(i,e){var t=new Date().getTime(),s=Math.max(0,16-(t-ne)),u=setTimeout(function(){i(t+s)},s);return ne=t+s,u}}}var Z=window.cancelAnimationFrame;typeof Z>"u"&&(typeof webkitCancelAnimationFrame<"u"?Z=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?Z=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?Z=msCancelAnimationFrame:typeof Z>"u"&&(Z=function(i){clearTimeout(i)}));var de=window.AudioContext;typeof de>"u"&&(typeof webkitAudioContext<"u"&&(de=webkitAudioContext),typeof mozAudioContext<"u"&&(de=mozAudioContext));var z=window.URL;typeof z>"u"&&typeof webkitURL<"u"&&(z=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var ue=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),he=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,L=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),C=!he&&!ue&&!!navigator.webkitGetUserMedia||Me()||navigator.userAgent.toLowerCase().indexOf("chrome/")!==-1,N=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);N&&!C&&navigator.userAgent.indexOf("CriOS")!==-1&&(N=!1,C=!0);var Q=window.MediaStream;typeof Q>"u"&&typeof webkitMediaStream<"u"&&(Q=webkitMediaStream),typeof Q<"u"&&typeof Q.prototype.stop>"u"&&(Q.prototype.stop=function(){this.getTracks().forEach(function(i){i.stop()})});function ye(i){var e=1e3,t=["Bytes","KB","MB","GB","TB"];if(i===0)return"0 Bytes";var s=parseInt(Math.floor(Math.log(i)/Math.log(e)),10);return(i/Math.pow(e,s)).toPrecision(3)+" "+t[s]}function Te(i,e){if(!i)throw"Blob object is required.";if(!i.type)try{i.type="video/webm"}catch{}var t=(i.type||"video/webm").split("/")[1];if(t.indexOf(";")!==-1&&(t=t.split(";")[0]),e&&e.indexOf(".")!==-1){var s=e.split(".");e=s[0],t=s[1]}var u=(e||Math.round(Math.random()*9999999999)+888888888)+"."+t;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(i,u);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(i,u);var d=document.createElement("a");d.href=z.createObjectURL(i),d.download=u,d.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(d),typeof d.click=="function"?d.click():(d.target="_blank",d.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),z.revokeObjectURL(d.href)}function Me(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}function k(i,e){return!i||!i.getTracks?[]:i.getTracks().filter(function(t){return t.kind===(e||"audio")})}function Ue(i,e){"srcObject"in e?e.srcObject=i:"mozSrcObject"in e?e.mozSrcObject=i:e.srcObject=i}function Be(i,e){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var t=new EBML.Reader,s=new EBML.Decoder,u=EBML.tools,d=new FileReader;d.onload=function(c){var r=s.decode(this.result);r.forEach(function(w){t.read(w)}),t.stop();var v=u.makeMetadataSeekable(t.metadatas,t.duration,t.cues),R=this.result.slice(t.metadataSize),f=new Blob([v,R],{type:"video/webm"});e(f)},d.readAsArrayBuffer(i)}typeof a<"u"&&(a.invokeSaveAsDialog=Te,a.getTracks=k,a.getSeekableBlob=Be,a.bytesToSize=ye,a.isElectron=Me);/**
 * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * Storage.AudioContext === webkitAudioContext
 * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var pe={};typeof de<"u"?pe.AudioContext=de:typeof webkitAudioContext<"u"&&(pe.AudioContext=webkitAudioContext),typeof a<"u"&&(a.Storage=pe);function le(){if(L||N||ue)return!0;var i=navigator.userAgent,e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10),s,u;return(C||he)&&(s=i.indexOf("Chrome"),e=i.substring(s+7)),(u=e.indexOf(";"))!==-1&&(e=e.substring(0,u)),(u=e.indexOf(" "))!==-1&&(e=e.substring(0,u)),t=parseInt(""+e,10),isNaN(t)&&(e=""+parseFloat(navigator.appVersion),t=parseInt(navigator.appVersion,10)),t>=49}/**
 * MediaStreamRecorder is an abstraction layer for {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}. It is used by {@link RecordRTC} to record MediaStream(s) in both Chrome and Firefox.
 * @summary Runs top over {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://github.com/muaz-khan|Muaz Khan}
 * @typedef MediaStreamRecorder
 * @class
 * @example
 * var config = {
 *     mimeType: 'video/webm', // vp8, vp9, h264, mkv, opus/vorbis
 *     audioBitsPerSecond : 256 * 8 * 1024,
 *     videoBitsPerSecond : 256 * 8 * 1024,
 *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
 *     checkForInactiveTracks: true,
 *     timeSlice: 1000, // concatenate intervals based blobs
 *     ondataavailable: function() {} // get intervals based blobs
 * }
 * var recorder = new MediaStreamRecorder(mediaStream, config);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", timeSlice: 1000}
 * @throws Will throw an error if first argument "MediaStream" is missing. Also throws error if "MediaRecorder API" are not supported by the browser.
 */function J(i,e){var f=this;if(typeof i>"u")throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if(e=e||{mimeType:"video/webm"},e.type==="audio"){if(k(i,"video").length&&k(i,"audio").length){var t;navigator.mozGetUserMedia?(t=new Q,t.addTrack(k(i,"audio")[0])):t=new Q(k(i,"audio")),i=t}(!e.mimeType||e.mimeType.toString().toLowerCase().indexOf("audio")===-1)&&(e.mimeType=C?"audio/webm":"audio/ogg"),e.mimeType&&e.mimeType.toString().toLowerCase()!=="audio/ogg"&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg")}var s=[];this.getArrayOfBlobs=function(){return s},this.record=function(){f.blob=null,f.clearRecordedData(),f.timestamps=[],R=[],s=[];var w=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",w),r&&(r=null),C&&!le()&&(w="video/vp8"),typeof MediaRecorder.isTypeSupported=="function"&&w.mimeType&&(MediaRecorder.isTypeSupported(w.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",w.mimeType),w.mimeType=e.type==="audio"?"audio/webm":"video/webm"));try{r=new MediaRecorder(i,w),e.mimeType=w.mimeType}catch{r=new MediaRecorder(i)}w.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in r&&r.canRecordMimeType(w.mimeType)===!1&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",w.mimeType)),r.ondataavailable=function(g){if(g.data&&R.push("ondataavailable: "+ye(g.data.size)),typeof e.timeSlice=="number"){if(g.data&&g.data.size&&(s.push(g.data),u(),typeof e.ondataavailable=="function")){var b=e.getNativeBlob?g.data:new Blob([g.data],{type:d(w)});e.ondataavailable(b)}return}if(!g.data||!g.data.size||g.data.size<100||f.blob){f.recordingCallback&&(f.recordingCallback(new Blob([],{type:d(w)})),f.recordingCallback=null);return}f.blob=e.getNativeBlob?g.data:new Blob([g.data],{type:d(w)}),f.recordingCallback&&(f.recordingCallback(f.blob),f.recordingCallback=null)},r.onstart=function(){R.push("started")},r.onpause=function(){R.push("paused")},r.onresume=function(){R.push("resumed")},r.onstop=function(){R.push("stopped")},r.onerror=function(g){g&&(g.name||(g.name="UnknownError"),R.push("error: "+g),e.disableLogs||(g.name.toString().toLowerCase().indexOf("invalidstate")!==-1?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",g):g.name.toString().toLowerCase().indexOf("notsupported")!==-1?console.error("MIME type (",w.mimeType,") is not supported.",g):g.name.toString().toLowerCase().indexOf("security")!==-1?console.error("MediaRecorder security error",g):g.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",g):g.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",g):g.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",g):g.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",g):console.error("MediaRecorder Error",g)),function(b){if(!f.manuallyStopped&&r&&r.state==="inactive"){delete e.timeslice,r.start(600*1e3);return}setTimeout(b,1e3)}(),r.state!=="inactive"&&r.state!=="stopped"&&r.stop())},typeof e.timeSlice=="number"?(u(),r.start(e.timeSlice)):r.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[];function u(){f.timestamps.push(new Date().getTime()),typeof e.onTimeStamp=="function"&&e.onTimeStamp(f.timestamps[f.timestamps.length-1],f.timestamps)}function d(w){return r&&r.mimeType?r.mimeType:w.mimeType||"video/webm"}this.stop=function(w){w=w||function(){},f.manuallyStopped=!0,r&&(this.recordingCallback=w,r.state==="recording"&&r.stop(),typeof e.timeSlice=="number"&&setTimeout(function(){f.blob=new Blob(s,{type:d(e)}),f.recordingCallback(f.blob)},100))},this.pause=function(){r&&r.state==="recording"&&r.pause()},this.resume=function(){r&&r.state==="paused"&&r.resume()},this.clearRecordedData=function(){r&&r.state==="recording"&&f.stop(c),c()};function c(){s=[],r=null,f.timestamps=[]}var r;this.getInternalRecorder=function(){return r};function v(){if("active"in i){if(!i.active)return!1}else if("ended"in i&&i.ended)return!1;return!0}this.blob=null,this.getState=function(){return r&&r.state||"inactive"};var R=[];this.getAllStates=function(){return R},typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!1);var f=this;(function w(){if(!(!r||e.checkForInactiveTracks===!1)){if(v()===!1){e.disableLogs||console.log("MediaStream seems stopped."),f.stop();return}setTimeout(w,1e3)}})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}typeof a<"u"&&(a.MediaStreamRecorder=J);/**
 * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
 * @summary JavaScript standalone object for stereo audio recording.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef StereoAudioRecorder
 * @class
 * @example
 * var recorder = new StereoAudioRecorder(MediaStream, {
 *     sampleRate: 44100,
 *     bufferSize: 4096
 * });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
 */function we(i,e){if(!k(i,"audio").length)throw"Your stream has no audio tracks.";e=e||{};var t=this,s=[],u=[],d=!1,c=0,r,v=2,R=e.desiredSampRate;e.leftChannel===!0&&(v=1),e.numberOfAudioChannels===1&&(v=1),(!v||v<1)&&(v=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+v),typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!0);function f(){if(e.checkForInactiveTracks===!1)return!0;if("active"in i){if(!i.active)return!1}else if("ended"in i&&i.ended)return!1;return!0}this.record=function(){if(f()===!1)throw"Please make sure MediaStream is active.";T(),l=y=!1,d=!0,typeof e.timeSlice<"u"&&B()};function w(I,$){function H(V,Ae){var ae=V.numberOfAudioChannels,ee=V.leftBuffers.slice(0),ve=V.rightBuffers.slice(0),te=V.sampleRate,ge=V.internalInterleavedLength,oe=V.desiredSampRate;ae===2&&(ee=qe(ee,ge),ve=qe(ve,ge),oe&&(ee=De(ee,oe,te),ve=De(ve,oe,te))),ae===1&&(ee=qe(ee,ge),oe&&(ee=De(ee,oe,te))),oe&&(te=oe);function De(G,fe,ie){var re=Math.round(G.length*(fe/ie)),X=[],be=Number((G.length-1)/(re-1));X[0]=G[0];for(var xe=1;xe<re-1;xe++){var Ve=xe*be,Je=Number(Math.floor(Ve)).toFixed(),dt=Number(Math.ceil(Ve)).toFixed(),ut=Ve-Je;X[xe]=rt(G[Je],G[dt],ut)}return X[re-1]=G[G.length-1],X}function rt(G,fe,ie){return G+(fe-G)*ie}function qe(G,fe){for(var ie=new Float64Array(fe),re=0,X=G.length,be=0;be<X;be++){var xe=G[be];ie.set(xe,re),re+=xe.length}return ie}function nt(G,fe){for(var ie=G.length+fe.length,re=new Float64Array(ie),X=0,be=0;be<ie;)re[be++]=G[X],re[be++]=fe[X],X++;return re}function _e(G,fe,ie){for(var re=ie.length,X=0;X<re;X++)G.setUint8(fe+X,ie.charCodeAt(X))}var Oe;ae===2&&(Oe=nt(ee,ve)),ae===1&&(Oe=ee);var Ee=Oe.length,at=44+Ee*2,We=new ArrayBuffer(at),K=new DataView(We);_e(K,0,"RIFF"),K.setUint32(4,36+Ee*2,!0),_e(K,8,"WAVE"),_e(K,12,"fmt "),K.setUint32(16,16,!0),K.setUint16(20,1,!0),K.setUint16(22,ae,!0),K.setUint32(24,te,!0),K.setUint32(28,te*ae*2,!0),K.setUint16(32,ae*2,!0),K.setUint16(34,16,!0),_e(K,36,"data"),K.setUint32(40,Ee*2,!0);for(var ot=Ee,Qe=44,st=1,ze=0;ze<ot;ze++)K.setInt16(Qe,Oe[ze]*(32767*st),!0),Qe+=2;if(Ae)return Ae({buffer:We,view:K});postMessage({buffer:We,view:K})}if(I.noWorker){H(I,function(V){$(V.buffer,V.view)});return}var me=g(H);me.onmessage=function(V){$(V.data.buffer,V.data.view),z.revokeObjectURL(me.workerURL),me.terminate()},me.postMessage(I)}function g(I){var $=z.createObjectURL(new Blob([I.toString(),";this.onmessage =  function (eee) {"+I.name+"(eee.data);}"],{type:"application/javascript"})),H=new Worker($);return H.workerURL=$,H}this.stop=function(I){I=I||function(){},d=!1,w({desiredSampRate:R,sampleRate:o,numberOfAudioChannels:v,internalInterleavedLength:c,leftBuffers:s,rightBuffers:v===1?[]:u,noWorker:e.noWorker},function($,H){t.blob=new Blob([H],{type:"audio/wav"}),t.buffer=new ArrayBuffer(H.buffer.byteLength),t.view=H,t.sampleRate=R||o,t.bufferSize=U,t.length=c,l=!1,I&&I(t.blob)})},typeof a.Storage>"u"&&(a.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!a.Storage.AudioContextConstructor||a.Storage.AudioContextConstructor.state==="closed")&&(a.Storage.AudioContextConstructor=new a.Storage.AudioContext);var b=a.Storage.AudioContextConstructor,m=b.createMediaStreamSource(i),M=[0,256,512,1024,2048,4096,8192,16384],U=typeof e.bufferSize>"u"?4096:e.bufferSize;if(M.indexOf(U)===-1&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(M,null,"	"))),b.createJavaScriptNode)r=b.createJavaScriptNode(U,v,v);else if(b.createScriptProcessor)r=b.createScriptProcessor(U,v,v);else throw"WebAudio API has no support on this browser.";m.connect(r),e.bufferSize||(U=r.bufferSize);var o=typeof e.sampleRate<"u"?e.sampleRate:b.sampleRate||44100;(o<22050||o>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var y=!1;this.pause=function(){y=!0},this.resume=function(){if(f()===!1)throw"Please make sure MediaStream is active.";if(!d){e.disableLogs||console.log("Seems recording has been restarted."),this.record();return}y=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,d&&this.stop(n),n()};function T(){s=[],u=[],c=0,l=!1,d=!1,y=!1,b=null,t.leftchannel=s,t.rightchannel=u,t.numberOfAudioChannels=v,t.desiredSampRate=R,t.sampleRate=o,t.recordingLength=c,S={left:[],right:[],recordingLength:0}}function n(){r&&(r.onaudioprocess=null,r.disconnect(),r=null),m&&(m.disconnect(),m=null),T()}this.name="StereoAudioRecorder",this.toString=function(){return this.name};var l=!1;function x(I){if(!y){if(f()===!1&&(e.disableLogs||console.log("MediaStream seems stopped."),r.disconnect(),d=!1),!d){m&&(m.disconnect(),m=null);return}l||(l=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var $=I.inputBuffer.getChannelData(0),H=new Float32Array($);if(s.push(H),v===2){var me=I.inputBuffer.getChannelData(1),V=new Float32Array(me);u.push(V)}c+=U,t.recordingLength=c,typeof e.timeSlice<"u"&&(S.recordingLength+=U,S.left.push(H),v===2&&S.right.push(V))}}r.onaudioprocess=x,b.createMediaStreamDestination?r.connect(b.createMediaStreamDestination()):r.connect(b.destination),this.leftchannel=s,this.rightchannel=u,this.numberOfAudioChannels=v,this.desiredSampRate=R,this.sampleRate=o,t.recordingLength=c;var S={left:[],right:[],recordingLength:0};function B(){!d||typeof e.ondataavailable!="function"||typeof e.timeSlice>"u"||(S.left.length?(w({desiredSampRate:R,sampleRate:o,numberOfAudioChannels:v,internalInterleavedLength:S.recordingLength,leftBuffers:S.left,rightBuffers:v===1?[]:S.right},function(I,$){var H=new Blob([$],{type:"audio/wav"});e.ondataavailable(H),setTimeout(B,e.timeSlice)}),S={left:[],right:[],recordingLength:0}):setTimeout(B,e.timeSlice))}}typeof a<"u"&&(a.StereoAudioRecorder=we);/**
 * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
 * @summary HTML2Canvas recording into video WebM.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef CanvasRecorder
 * @class
 * @example
 * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true, useWhammyRecorder: true });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
 * @param {object} config - {disableLogs:true, initCallback: function}
 */function Re(i,e){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";e=e||{},e.frameInterval||(e.frameInterval=10);var t=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(M){M in document.createElement("canvas")&&(t=!0)});var s=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,u=50,d=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);s&&d&&d[2]&&(u=parseInt(d[2],10)),s&&u<52&&(t=!1),e.useWhammyRecorder&&(t=!1);var c,r;if(t)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),i instanceof HTMLCanvasElement)c=i;else if(i instanceof CanvasRenderingContext2D)c=i.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var v;this.record=function(){if(v=!0,t&&!e.useWhammyRecorder){var M;"captureStream"in c?M=c.captureStream(25):"mozCaptureStream"in c?M=c.mozCaptureStream(25):"webkitCaptureStream"in c&&(M=c.webkitCaptureStream(25));try{var U=new Q;U.addTrack(k(M,"video")[0]),M=U}catch{}if(!M)throw"captureStream API are NOT available.";r=new J(M,{mimeType:e.mimeType||"video/webm"}),r.record()}else m.frames=[],b=new Date().getTime(),g();e.initCallback&&e.initCallback()},this.getWebPImages=function(M){if(i.nodeName.toLowerCase()!=="canvas"){M();return}var U=m.frames.length;m.frames.forEach(function(o,y){var T=U-y;e.disableLogs||console.log(T+"/"+U+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(T,U);var n=o.image.toDataURL("image/webp",1);m.frames[y].image=n}),e.disableLogs||console.log("Generating WebM"),M()},this.stop=function(M){v=!1;var U=this;if(t&&r){r.stop(M);return}this.getWebPImages(function(){m.compile(function(o){e.disableLogs||console.log("Recording finished!"),U.blob=o,U.blob.forEach&&(U.blob=new Blob([],{type:"video/webm"})),M&&M(U.blob),m.frames=[]})})};var R=!1;this.pause=function(){if(R=!0,r instanceof J){r.pause();return}},this.resume=function(){if(R=!1,r instanceof J){r.resume();return}v||this.record()},this.clearRecordedData=function(){v&&this.stop(f),f()};function f(){m.frames=[],v=!1,R=!1}this.name="CanvasRecorder",this.toString=function(){return this.name};function w(){var M=document.createElement("canvas"),U=M.getContext("2d");return M.width=i.width,M.height=i.height,U.drawImage(i,0,0),M}function g(){if(R)return b=new Date().getTime(),setTimeout(g,500);if(i.nodeName.toLowerCase()==="canvas"){var M=new Date().getTime()-b;b=new Date().getTime(),m.frames.push({image:w(),duration:M}),v&&setTimeout(g,e.frameInterval);return}html2canvas(i,{grabMouse:typeof e.showMousePointer>"u"||e.showMousePointer,onrendered:function(U){var o=new Date().getTime()-b;if(!o)return setTimeout(g,e.frameInterval);b=new Date().getTime(),m.frames.push({image:U.toDataURL("image/webp",1),duration:o}),v&&setTimeout(g,e.frameInterval)}})}var b=new Date().getTime(),m=new Ce.Video(100)}typeof a<"u"&&(a.CanvasRecorder=Re);/**
 * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
 * @summary Video recording feature in Chrome.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WhammyRecorder
 * @class
 * @example
 * var recorder = new WhammyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
 */function ke(i,e){e=e||{},e.frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),v.width=e.canvas.width||320,v.height=e.canvas.height||240,R=v.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(f=e.video.cloneNode(),e.initCallback&&e.initCallback()):(f=document.createElement("video"),Ue(i,f),f.onloadedmetadata=function(){e.initCallback&&e.initCallback()},f.width=e.video.width,f.height=e.video.height),f.muted=!0,f.play(),w=new Date().getTime(),g=new Ce.Video,e.disableLogs||(console.log("canvas resolutions",v.width,"*",v.height),console.log("video width/height",f.width||v.width,"*",f.height||v.height)),t(e.frameInterval)};function t(b){b=typeof b<"u"?b:10;var m=new Date().getTime()-w;if(!m)return setTimeout(t,b,b);if(c)return w=new Date().getTime(),setTimeout(t,100);w=new Date().getTime(),f.paused&&f.play(),R.drawImage(f,0,0,v.width,v.height),g.frames.push({duration:m,image:v.toDataURL("image/webp")}),d||setTimeout(t,b,b)}function s(b){var m=-1,M=b.length;(function U(){if(m++,m===M){b.callback();return}setTimeout(function(){b.functionToLoop(U,m)},1)})()}function u(b,m,M,U,o){var y=document.createElement("canvas");y.width=v.width,y.height=v.height;var T=y.getContext("2d"),n=[],l=b.length,x={r:0,g:0,b:0},S=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),B=0,I=0,$=!1;s({length:l,functionToLoop:function(H,me){var V,Ae,ae,ee=function(){!$&&ae-V<=ae*I||($=!0,n.push(b[me])),H()};if($)ee();else{var ve=new Image;ve.onload=function(){T.drawImage(ve,0,0,v.width,v.height);var te=T.getImageData(0,0,v.width,v.height);V=0,Ae=te.data.length,ae=te.data.length/4;for(var ge=0;ge<Ae;ge+=4){var oe={r:te.data[ge],g:te.data[ge+1],b:te.data[ge+2]},De=Math.sqrt(Math.pow(oe.r-x.r,2)+Math.pow(oe.g-x.g,2)+Math.pow(oe.b-x.b,2));De<=S*B&&V++}ee()},ve.src=b[me].image}},callback:function(){n=n.concat(b.slice(l)),n.length<=0&&n.push(b[b.length-1]),o(n)}})}var d=!1;this.stop=function(b){b=b||function(){},d=!0;var m=this;setTimeout(function(){u(g.frames,-1,null,null,function(M){g.frames=M,e.advertisement&&e.advertisement.length&&(g.frames=e.advertisement.concat(g.frames)),g.compile(function(U){m.blob=U,m.blob.forEach&&(m.blob=new Blob([],{type:"video/webm"})),b&&b(m.blob)})})},10)};var c=!1;this.pause=function(){c=!0},this.resume=function(){c=!1,d&&this.record()},this.clearRecordedData=function(){d||this.stop(r),r()};function r(){g.frames=[],d=!0,c=!1}this.name="WhammyRecorder",this.toString=function(){return this.name};var v=document.createElement("canvas"),R=v.getContext("2d"),f,w,g}typeof a<"u"&&(a.WhammyRecorder=ke);/**
 * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
 * @summary A real time javascript webm encoder based on a canvas hack.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef Whammy
 * @class
 * @example
 * var recorder = new Whammy().Video(15);
 * recorder.add(context || canvas || dataURL);
 * var output = recorder.compile();
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var Ce=function(){function i(s){this.frames=[],this.duration=s||1,this.quality=.8}i.prototype.add=function(s,u){if("canvas"in s&&(s=s.canvas),"toDataURL"in s&&(s=s.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(s))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:s,duration:u||this.duration})};function e(s){var u=z.createObjectURL(new Blob([s.toString(),"this.onmessage =  function (eee) {"+s.name+"(eee.data);}"],{type:"application/javascript"})),d=new Worker(u);return z.revokeObjectURL(u),d}function t(s){function u(o){var y=c(o);if(!y)return[];for(var T=3e4,n=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:M(y.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:y.width,id:176},{data:y.height,id:186}]}]}]}]}],l=0,x=0;l<o.length;){var S=[],B=0;do S.push(o[l]),B+=o[l].duration,l++;while(l<o.length&&B<T);var I=0,$={id:524531317,data:d(x,I,S)};n[1].data.push($),x+=B}return f(n)}function d(o,y,T){return[{data:o,id:231}].concat(T.map(function(n){var l=w({frame:n.data.slice(4),trackNum:1,timecode:Math.round(y)});return y+=n.duration,{data:l,id:163}}))}function c(o){if(!o[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}for(var y=o[0].width,T=o[0].height,n=o[0].duration,l=1;l<o.length;l++)n+=o[l].duration;return{duration:n,width:y,height:T}}function r(o){for(var y=[];o>0;)y.push(o&255),o=o>>8;return new Uint8Array(y.reverse())}function v(o){return new Uint8Array(o.split("").map(function(y){return y.charCodeAt(0)}))}function R(o){var y=[],T=o.length%8?new Array(9-o.length%8).join("0"):"";o=T+o;for(var n=0;n<o.length;n+=8)y.push(parseInt(o.substr(n,8),2));return new Uint8Array(y)}function f(o){for(var y=[],T=0;T<o.length;T++){var n=o[T].data;typeof n=="object"&&(n=f(n)),typeof n=="number"&&(n=R(n.toString(2))),typeof n=="string"&&(n=v(n));var l=n.size||n.byteLength||n.length,x=Math.ceil(Math.ceil(Math.log(l)/Math.log(2))/8),S=l.toString(2),B=new Array(x*7+7+1-S.length).join("0")+S,I=new Array(x).join("0")+"1"+B;y.push(r(o[T].id)),y.push(R(I)),y.push(n)}return new Blob(y,{type:"video/webm"})}function w(o){var y=0;y|=128;var T=[o.trackNum|128,o.timecode>>8,o.timecode&255,y].map(function(n){return String.fromCharCode(n)}).join("")+o.frame;return T}function g(o){for(var y=o.RIFF[0].WEBP[0],T=y.indexOf("*"),n=0,l=[];n<4;n++)l[n]=y.charCodeAt(T+3+n);var x,S,B;return B=l[1]<<8|l[0],x=B&16383,B=l[3]<<8|l[2],S=B&16383,{width:x,height:S,data:y,riff:o}}function b(o,y){return parseInt(o.substr(y+4,4).split("").map(function(T){var n=T.charCodeAt(0).toString(2);return new Array(8-n.length+1).join("0")+n}).join(""),2)}function m(o){for(var y=0,T={};y<o.length;){var n=o.substr(y,4),l=b(o,y),x=o.substr(y+4+4,l);y+=8+l,T[n]=T[n]||[],n==="RIFF"||n==="LIST"?T[n].push(m(x)):T[n].push(x)}return T}function M(o){return[].slice.call(new Uint8Array(new Float64Array([o]).buffer),0).map(function(y){return String.fromCharCode(y)}).reverse().join("")}var U=new u(s.map(function(o){var y=g(m(atob(o.image.slice(23))));return y.duration=o.duration,y}));postMessage(U)}return i.prototype.compile=function(s){var u=e(t);u.onmessage=function(d){if(d.data.error){console.error(d.data.error);return}s(d.data)},u.postMessage(this.frames)},{Video:i}}();typeof a<"u"&&(a.Whammy=Ce);/**
 * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
 * @summary Writing blobs into IndexedDB.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * DiskStorage.Store({
 *     audioBlob: yourAudioBlob,
 *     videoBlob: yourVideoBlob,
 *     gifBlob  : yourGifBlob
 * });
 * DiskStorage.Fetch(function(dataURL, type) {
 *     if(type === 'audioBlob') { }
 *     if(type === 'videoBlob') { }
 *     if(type === 'gifBlob')   { }
 * });
 * // DiskStorage.dataStoreName = 'recordRTC';
 * // DiskStorage.onError = function(error) { };
 * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
 * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
 * @property {function} Store - This method stores blobs in IndexedDB.
 * @property {function} onError - This function is invoked for any known/unknown error.
 * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var ce={init:function(){var i=this;if(typeof indexedDB>"u"||typeof indexedDB.open>"u"){console.error("IndexedDB API are not available in this browser.");return}var e=1,t=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),s,u=indexedDB.open(t,e);function d(r){r.createObjectStore(i.dataStoreName)}function c(){var r=s.transaction([i.dataStoreName],"readwrite");i.videoBlob&&r.objectStore(i.dataStoreName).put(i.videoBlob,"videoBlob"),i.gifBlob&&r.objectStore(i.dataStoreName).put(i.gifBlob,"gifBlob"),i.audioBlob&&r.objectStore(i.dataStoreName).put(i.audioBlob,"audioBlob");function v(R){r.objectStore(i.dataStoreName).get(R).onsuccess=function(f){i.callback&&i.callback(f.target.result,R)}}v("audioBlob"),v("videoBlob"),v("gifBlob")}u.onerror=i.onError,u.onsuccess=function(){if(s=u.result,s.onerror=i.onError,s.setVersion)if(s.version!==e){var r=s.setVersion(e);r.onsuccess=function(){d(s),c()}}else c();else c()},u.onupgradeneeded=function(r){d(r.target.result)}},Fetch:function(i){return this.callback=i,this.init(),this},Store:function(i){return this.audioBlob=i.audioBlob,this.videoBlob=i.videoBlob,this.gifBlob=i.gifBlob,this.init(),this},onError:function(i){console.error(JSON.stringify(i,null,"	"))},dataStoreName:"recordRTC",dbName:null};typeof a<"u"&&(a.DiskStorage=ce);/**
 * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GifRecorder
 * @class
 * @example
 * var recorder = new GifRecorder(mediaStream || canvas || context, { onGifPreview: function, onGifRecordingStarted: function, width: 1280, height: 720, frameRate: 200, quality: 10 });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     img.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
 * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
 */function Fe(i,e){if(typeof GIFEncoder>"u"){var t=document.createElement("script");t.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)}e=e||{};var s=i instanceof CanvasRenderingContext2D||i instanceof HTMLCanvasElement;this.record=function(){if(typeof GIFEncoder>"u"){setTimeout(b.record,1e3);return}if(!v){setTimeout(b.record,1e3);return}s||(e.width||(e.width=R.offsetWidth||320),e.height||(e.height=R.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),c.width=e.canvas.width||320,c.height=e.canvas.height||240,R.width=e.video.width||320,R.height=e.video.height||240),g=new GIFEncoder,g.setRepeat(0),g.setDelay(e.frameRate||200),g.setQuality(e.quality||10),g.start(),typeof e.onGifRecordingStarted=="function"&&e.onGifRecordingStarted();function m(M){if(b.clearedRecordedData!==!0){if(u)return setTimeout(function(){m(M)},100);f=E(m),typeof w===void 0&&(w=M),!(M-w<90)&&(!s&&R.paused&&R.play(),s||r.drawImage(R,0,0,c.width,c.height),e.onGifPreview&&e.onGifPreview(c.toDataURL("image/png")),g.addFrame(r),w=M)}}f=E(m),e.initCallback&&e.initCallback()},this.stop=function(m){m=m||function(){},f&&Z(f),this.blob=new Blob([new Uint8Array(g.stream().bin)],{type:"image/gif"}),m(this.blob),g.stream().bin=[]};var u=!1;this.pause=function(){u=!0},this.resume=function(){u=!1},this.clearRecordedData=function(){b.clearedRecordedData=!0,d()};function d(){g&&(g.stream().bin=[])}this.name="GifRecorder",this.toString=function(){return this.name};var c=document.createElement("canvas"),r=c.getContext("2d");s&&(i instanceof CanvasRenderingContext2D?(r=i,c=r.canvas):i instanceof HTMLCanvasElement&&(r=i.getContext("2d"),c=i));var v=!0;if(!s){var R=document.createElement("video");R.muted=!0,R.autoplay=!0,R.playsInline=!0,v=!1,R.onloadedmetadata=function(){v=!0},Ue(i,R),R.play()}var f=null,w,g,b=this}typeof a<"u"&&(a.GifRecorder=Fe);function Ke(i,e){var t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(n){typeof a<"u"||n&&(typeof window<"u"||typeof q>"u"||(q.navigator={userAgent:t,getUserMedia:function(){}},q.console||(q.console={}),(typeof q.console.log>"u"||typeof q.console.error>"u")&&(q.console.error=q.console.log=q.console.log||function(){console.log(arguments)}),typeof document>"u"&&(n.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var l={getContext:function(){return l},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return l},n.HTMLVideoElement=function(){}),typeof location>"u"&&(n.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(n.screen={width:0,height:0}),typeof R>"u"&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),n.window=q))})(typeof q<"u"?q:null),e=e||"multi-streams-mixer";var s=[],u=!1,d=document.createElement("canvas"),c=d.getContext("2d");d.style.opacity=0,d.style.position="absolute",d.style.zIndex=-1,d.style.top="-1000em",d.style.left="-1000em",d.className=e,(document.body||document.documentElement).appendChild(d),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var r=this,v=window.AudioContext;typeof v>"u"&&(typeof webkitAudioContext<"u"&&(v=webkitAudioContext),typeof mozAudioContext<"u"&&(v=mozAudioContext));var R=window.URL;typeof R>"u"&&typeof webkitURL<"u"&&(R=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var f=window.MediaStream;typeof f>"u"&&typeof webkitMediaStream<"u"&&(f=webkitMediaStream),typeof f<"u"&&typeof f.prototype.stop>"u"&&(f.prototype.stop=function(){this.getTracks().forEach(function(n){n.stop()})});var w={};typeof v<"u"?w.AudioContext=v:typeof webkitAudioContext<"u"&&(w.AudioContext=webkitAudioContext);function g(n,l){"srcObject"in l?l.srcObject=n:"mozSrcObject"in l?l.mozSrcObject=n:l.srcObject=n}this.startDrawingFrames=function(){b()};function b(){if(!u){var n=s.length,l=!1,x=[];if(s.forEach(function(B){B.stream||(B.stream={}),B.stream.fullcanvas?l=B:x.push(B)}),l)d.width=l.stream.width,d.height=l.stream.height;else if(x.length){d.width=n>1?x[0].width*2:x[0].width;var S=1;(n===3||n===4)&&(S=2),(n===5||n===6)&&(S=3),(n===7||n===8)&&(S=4),(n===9||n===10)&&(S=5),d.height=x[0].height*S}else d.width=r.width||360,d.height=r.height||240;l&&l instanceof HTMLVideoElement&&m(l),x.forEach(function(B,I){m(B,I)}),setTimeout(b,r.frameInterval)}}function m(n,l){if(!u){var x=0,S=0,B=n.width,I=n.height;l===1&&(x=n.width),l===2&&(S=n.height),l===3&&(x=n.width,S=n.height),l===4&&(S=n.height*2),l===5&&(x=n.width,S=n.height*2),l===6&&(S=n.height*3),l===7&&(x=n.width,S=n.height*3),typeof n.stream.left<"u"&&(x=n.stream.left),typeof n.stream.top<"u"&&(S=n.stream.top),typeof n.stream.width<"u"&&(B=n.stream.width),typeof n.stream.height<"u"&&(I=n.stream.height),c.drawImage(n,x,S,B,I),typeof n.stream.onRender=="function"&&n.stream.onRender(c,x,S,B,I,l)}}function M(){u=!1;var n=U(),l=o();return l&&l.getTracks().filter(function(x){return x.kind==="audio"}).forEach(function(x){n.addTrack(x)}),i.forEach(function(x){x.fullcanvas}),n}function U(){T();var n;"captureStream"in d?n=d.captureStream():"mozCaptureStream"in d?n=d.mozCaptureStream():r.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var l=new f;return n.getTracks().filter(function(x){return x.kind==="video"}).forEach(function(x){l.addTrack(x)}),d.stream=l,l}function o(){w.AudioContextConstructor||(w.AudioContextConstructor=new w.AudioContext),r.audioContext=w.AudioContextConstructor,r.audioSources=[],r.useGainNode===!0&&(r.gainNode=r.audioContext.createGain(),r.gainNode.connect(r.audioContext.destination),r.gainNode.gain.value=0);var n=0;if(i.forEach(function(l){if(l.getTracks().filter(function(S){return S.kind==="audio"}).length){n++;var x=r.audioContext.createMediaStreamSource(l);r.useGainNode===!0&&x.connect(r.gainNode),r.audioSources.push(x)}}),!!n)return r.audioDestination=r.audioContext.createMediaStreamDestination(),r.audioSources.forEach(function(l){l.connect(r.audioDestination)}),r.audioDestination.stream}function y(n){var l=document.createElement("video");return g(n,l),l.className=e,l.muted=!0,l.volume=0,l.width=n.width||r.width||360,l.height=n.height||r.height||240,l.play(),l}this.appendStreams=function(n){if(!n)throw"First parameter is required.";n instanceof Array||(n=[n]),n.forEach(function(l){var x=new f;if(l.getTracks().filter(function(I){return I.kind==="video"}).length){var S=y(l);S.stream=l,s.push(S),x.addTrack(l.getTracks().filter(function(I){return I.kind==="video"})[0])}if(l.getTracks().filter(function(I){return I.kind==="audio"}).length){var B=r.audioContext.createMediaStreamSource(l);r.audioDestination=r.audioContext.createMediaStreamDestination(),B.connect(r.audioDestination),x.addTrack(r.audioDestination.stream.getTracks().filter(function(I){return I.kind==="audio"})[0])}i.push(x)})},this.releaseStreams=function(){s=[],u=!0,r.gainNode&&(r.gainNode.disconnect(),r.gainNode=null),r.audioSources.length&&(r.audioSources.forEach(function(n){n.disconnect()}),r.audioSources=[]),r.audioDestination&&(r.audioDestination.disconnect(),r.audioDestination=null),r.audioContext&&r.audioContext.close(),r.audioContext=null,c.clearRect(0,0,d.width,d.height),d.stream&&(d.stream.stop(),d.stream=null)},this.resetVideoStreams=function(n){n&&!(n instanceof Array)&&(n=[n]),T(n)};function T(n){s=[],n=n||i,n.forEach(function(l){if(l.getTracks().filter(function(S){return S.kind==="video"}).length){var x=y(l);x.stream=l,s.push(x)}})}this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=M}typeof a>"u"&&(h.exports=Ke);/**
 * MultiStreamRecorder can record multiple videos in single container.
 * @summary Multi-videos recorder.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MultiStreamRecorder
 * @class
 * @example
 * var options = {
 *     mimeType: 'video/webm'
 * }
 * var recorder = new MultiStreamRecorder(ArrayOfMediaStreams, options);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStreams} mediaStreams - Array of MediaStreams.
 * @param {object} config - {disableLogs:true, frameInterval: 1, mimeType: "video/webm"}
 */function Ye(i,e){i=i||[];var t=this,s,u;e=e||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}},e.frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){s=new Ke(i,e.elementClass||"multi-streams-mixer"),d().length&&(s.frameInterval=e.frameInterval||10,s.width=e.video.width||360,s.height=e.video.height||240,s.startDrawingFrames()),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(s.getMixedStream()),u=new J(s.getMixedStream(),e),u.record()};function d(){var c=[];return i.forEach(function(r){k(r,"video").forEach(function(v){c.push(v)})}),c}this.stop=function(c){u&&u.stop(function(r){t.blob=r,c(r),t.clearRecordedData()})},this.pause=function(){u&&u.pause()},this.resume=function(){u&&u.resume()},this.clearRecordedData=function(){u&&(u.clearRecordedData(),u=null),s&&(s.releaseStreams(),s=null)},this.addStreams=function(c){if(!c)throw"First parameter is required.";c instanceof Array||(c=[c]),i.concat(c),!(!u||!s)&&(s.appendStreams(c),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(s.getMixedStream()))},this.resetVideoStreams=function(c){s&&(c&&!(c instanceof Array)&&(c=[c]),s.resetVideoStreams(c))},this.getMixer=function(){return s},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}typeof a<"u"&&(a.MultiStreamRecorder=Ye);/**
 * RecordRTCPromisesHandler adds promises support in {@link RecordRTC}. Try a {@link https://github.com/muaz-khan/RecordRTC/blob/master/simple-demos/RecordRTCPromisesHandler.html|demo here}
 * @summary Promises for {@link RecordRTC}
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCPromisesHandler
 * @class
 * @example
 * var recorder = new RecordRTCPromisesHandler(mediaStream, options);
 * recorder.startRecording()
 *         .then(successCB)
 *         .catch(errorCB);
 * // Note: You can access all RecordRTC API using "recorder.recordRTC" e.g. 
 * recorder.recordRTC.onStateChanged = function(state) {};
 * recorder.recordRTC.setRecordingDuration(5000);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 * @throws Will throw an error if "new" keyword is not used to initiate "RecordRTCPromisesHandler". Also throws error if first argument "MediaStream" is missing.
 * @requires {@link RecordRTC}
 */function it(i,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(typeof i>"u")throw'First argument "MediaStream" is required.';var t=this;t.recordRTC=new a(i,e),this.startRecording=function(){return new Promise(function(s,u){try{t.recordRTC.startRecording(),s()}catch(d){u(d)}})},this.stopRecording=function(){return new Promise(function(s,u){try{t.recordRTC.stopRecording(function(d){if(t.blob=t.recordRTC.getBlob(),!t.blob||!t.blob.size){u("Empty blob.",t.blob);return}s(d)})}catch(d){u(d)}})},this.pauseRecording=function(){return new Promise(function(s,u){try{t.recordRTC.pauseRecording(),s()}catch(d){u(d)}})},this.resumeRecording=function(){return new Promise(function(s,u){try{t.recordRTC.resumeRecording(),s()}catch(d){u(d)}})},this.getDataURL=function(s){return new Promise(function(u,d){try{t.recordRTC.getDataURL(function(c){u(c)})}catch(c){d(c)}})},this.getBlob=function(){return new Promise(function(s,u){try{s(t.recordRTC.getBlob())}catch(d){u(d)}})},this.getInternalRecorder=function(){return new Promise(function(s,u){try{s(t.recordRTC.getInternalRecorder())}catch(d){u(d)}})},this.reset=function(){return new Promise(function(s,u){try{s(t.recordRTC.reset())}catch(d){u(d)}})},this.destroy=function(){return new Promise(function(s,u){try{s(t.recordRTC.destroy())}catch(d){u(d)}})},this.getState=function(){return new Promise(function(s,u){try{s(t.recordRTC.getState())}catch(d){u(d)}})},this.blob=null,this.version="5.6.2"}typeof a<"u"&&(a.RecordRTCPromisesHandler=it);/**
 * WebAssemblyRecorder lets you create webm videos in JavaScript via WebAssembly. The library consumes raw RGBA32 buffers (4 bytes per pixel) and turns them into a webm video with the given framerate and quality. This makes it compatible out-of-the-box with ImageData from a CANVAS. With realtime mode you can also use webm-wasm for streaming webm videos.
 * @summary Video recording feature in Chrome, Firefox and maybe Edge.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WebAssemblyRecorder
 * @class
 * @example
 * var recorder = new WebAssemblyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {webAssemblyPath:'webm-wasm.wasm',workerPath: 'webm-worker.js', frameRate: 30, width: 1920, height: 1080, bitrate: 1024, realtime: true}
 */function Le(i,e){(typeof ReadableStream>"u"||typeof WritableStream>"u")&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),e=e||{},e.width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,e.realtime=e.realtime||!0;var t;function s(){return new ReadableStream({start:function(R){var f=document.createElement("canvas"),w=document.createElement("video"),g=!0;w.srcObject=i,w.muted=!0,w.height=e.height,w.width=e.width,w.volume=0,w.onplaying=function(){f.width=e.width,f.height=e.height;var b=f.getContext("2d"),m=1e3/e.frameRate,M=setInterval(function(){if(t&&(clearInterval(M),R.close()),g&&(g=!1,e.onVideoProcessStarted&&e.onVideoProcessStarted()),b.drawImage(w,0,0),R._controlledReadableStream.state!=="closed")try{R.enqueue(b.getImageData(0,0,e.width,e.height))}catch{}},m)},w.play()}})}var u;function d(R,f){if(!e.workerPath&&!f){t=!1,fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(g){g.arrayBuffer().then(function(b){d(R,b)})});return}if(!e.workerPath&&f instanceof ArrayBuffer){var w=new Blob([f],{type:"text/javascript"});e.workerPath=z.createObjectURL(w)}e.workerPath||console.error("workerPath parameter is missing."),u=new Worker(e.workerPath),u.postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),u.addEventListener("message",function(g){g.data==="READY"?(u.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:e.realtime}),s().pipeTo(new WritableStream({write:function(b){if(t){console.error("Got image, but recorder is finished!");return}u.postMessage(b.data.buffer,[b.data.buffer])}}))):g.data&&(c||v.push(g.data))})}this.record=function(){v=[],c=!1,this.blob=null,d(i),typeof e.initCallback=="function"&&e.initCallback()};var c;this.pause=function(){c=!0},this.resume=function(){c=!1};function r(R){if(!u){R&&R();return}u.addEventListener("message",function(f){f.data===null&&(u.terminate(),u=null,R&&R())}),u.postMessage(null)}var v=[];this.stop=function(R){t=!0;var f=this;r(function(){f.blob=new Blob(v,{type:"video/webm"}),R(f.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){v=[],c=!1,this.blob=null},this.blob=null}typeof a<"u"&&(a.WebAssemblyRecorder=Le)}($e)),$e.exports}var Wt=qt();const zt=ht(Wt),Vt={key:0,class:"alert alert-danger flex h-16 items-center justify-between px-6"},Gt={class:""},$t={key:1,class:"flex h-16 items-center justify-between rounded-md bg-gray-50 px-4 shadow-sm dark:bg-dark-800"},Ht={class:"mr-3 flex flex-1 items-center justify-end"},Kt={key:0,class:"flex items-center gap-2"},Yt={class:"flex items-center gap-1"},Qt={class:"text-sm font-medium text-red-600 dark:text-red-400"},Jt={class:"text-sm font-medium text-gray-600 dark:text-gray-300"},Xt={class:"rounded-full bg-slate-200 dark:bg-dark-600"},Zt=["src"],ei={class:"mr-2 flex items-center gap-3"},ti=["disabled"],ii={__name:"VoiceRecorder",props:{store:{type:Object,required:!0}},setup(h){const a=Nt(),p=Ie({blob:null,url:null,file:null,isRecording:!1,duration:0}),F=Ie(!0),A=Ie(null),_=Ie(null),E=pt(()=>{const L=Math.floor(p.value.duration/60),C=p.value.duration%60;return`${L.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`}),ne=async()=>{try{const L=await navigator.mediaDevices.getUserMedia({audio:!0});A.value=new zt(L,{type:"audio"}),A.value.startRecording(),p.value.isRecording=!0,p.value.duration=0,_.value=setInterval(()=>{p.value.duration++},1e3)}catch(L){console.error("Error accessing microphone:",L),F.value=!1,p.value.isRecording=!1}},Z=()=>{A.value&&A.value.stopRecording(()=>{p.value.blob=A.value.getBlob(),p.value.url=URL.createObjectURL(p.value.blob),_.value&&clearInterval(_.value);try{const L=A.value.stream;L&&L.getTracks&&L.getTracks().forEach(C=>C.stop())}catch(L){console.warn("Could not stop media tracks:",L)}finally{p.value.isRecording=!1,A.value.destroy(),A.value=null}})},de=()=>{p.value.url&&URL.revokeObjectURL(p.value.url),p.value.url=null,p.value.blob=null,p.value.file=null,p.value.isRecording=!1,p.value.duration=0},z=()=>{Z(),de(),a.inputMessage.type="text"},ue=()=>{a.inputMessage.type="voice",a.inputMessage.attachments=[p.value.blob],a.submitMessage()},he=()=>{window.location.reload()};return mt(()=>{_.value&&clearInterval(_.value),A.value&&(A.value.destroy(),A.value=null),p.value.url&&URL.revokeObjectURL(p.value.url)}),(L,C)=>{const N=tt("Icon");return F.value?(O(),j("div",$t,[D("button",{type:"button",onClick:z,class:"flex h-8 w-8 items-center justify-center rounded-full transition-colors hover:bg-gray-200 dark:hover:bg-dark-700"},[W(N,{icon:"bx:x",class:"text-gray-600 dark:text-gray-300"})]),D("div",Ht,[p.value.isRecording?(O(),j("div",Kt,[D("div",Yt,[C[0]||(C[0]=D("div",{class:"h-3 w-3 animate-pulse rounded-full bg-red-500"},null,-1)),D("span",Qt,se(E.value),1)]),D("div",Jt,se(L.trans("Recording"))+"... ",1)])):Y("",!0),D("div",Xt,[p.value.url&&!p.value.isRecording?(O(),j("audio",{key:0,src:p.value.url,controls:"",class:"h-10 w-64 opacity-60 dark:opacity-50"},null,8,Zt)):Y("",!0)])]),D("div",ei,[p.value.url?(O(),j("button",{key:0,type:"button",onClick:de,class:"flex h-8 w-8 items-center justify-center rounded-full transition-colors hover:bg-gray-200 dark:hover:bg-dark-700"},[W(N,{icon:"bx:trash",class:"text-red-500 dark:text-red-400"})])):Y("",!0),!p.value.url&&!p.value.isRecording?(O(),j("button",{key:1,type:"button",onClick:ne,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 transition-colors hover:bg-gray-300 dark:bg-dark-700 dark:hover:bg-dark-600"},[W(N,{icon:"bx:microphone",class:"text-gray-700 dark:text-gray-200"})])):!p.value.url&&p.value.isRecording?(O(),j("button",{key:2,type:"button",onClick:Z,class:"flex h-8 w-8 items-center justify-center rounded-full bg-red-100 transition-colors hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-900/50"},[W(N,{icon:"bx:stop",class:"text-xl text-red-600 dark:text-red-400"})])):Y("",!0),p.value.url&&!p.value.isRecording?(O(),j("button",{key:3,onClick:ue,disabled:P(a).loading.sendingMessage,class:"flex h-8 w-8 items-center justify-center rounded-full bg-green-500 transition-colors hover:bg-green-600"},[P(a).loading.sendingMessage?(O(),Ne(jt,{key:0})):(O(),Ne(N,{key:1,icon:"bx:send",class:"text-white"}))],8,ti)):Y("",!0)])])):(O(),j("div",Vt,[D("p",Gt,se(L.trans("This device does not support voice recording or does not have microphone access.")),1),D("button",{type:"button",class:"btn btn-secondary",onClick:he},se(L.trans("Reload")),1)]))}}},ri={class:"relative ml-2 flex h-[calc(100vh-11rem)] w-full flex-col overflow-hidden rounded-md bg-white shadow transition-all dark:bg-dark-800"},ni={class:"styled-scrollbar whatsapp-chat-body relative h-[82%] overflow-auto px-4 pb-8"},ai={key:0,class:"space-y-3",id:"scrollContainerRef"},oi={class:"my-2 text-center"},si={key:0,class:"flex gap-x-3 group-[.pr]:flex-row-reverse"},di={key:0,class:"avatar avatar-circle avatar-sm shrink-0"},ui=["src"],li={class:"flex max-w-sm flex-col items-start group-[.pr]:items-end"},ci={key:0,class:"rounded-t-lg bg-white bg-opacity-50 p-2 text-sm italic text-gray-500"},fi={class:"flex items-center"},hi={class:"mb-2"},pi=["title"],mi=["title"],vi={key:0,class:"bx bx-circle"},gi={key:1,class:"bx bx-check"},bi={key:2,class:"bx bx-check-double"},yi={key:3,class:"bx bx-check-double text-green-600"},wi={key:1,class:"h-200 flex items-center justify-center"},Ri={class:"relative bottom-0 left-0 z-10 rounded-b-primary border-t bg-white dark:border-dark-700 dark:bg-dark-800"},ki=["onKeydown","disabled"],xi={class:"flex items-center gap-x-4 px-4"},Ci={class:"relative"},Si={key:0,class:"absolute bottom-full right-0"},Ti={class:"mb-2 space-y-2 rounded-md bg-dark-900 p-3"},zi={__name:"MessageContainer",setup(h){const a=At(),p=Dt(),F=je(),{loading:A,assetPopup:_,inputMessage:E,activeConversation:ne,messageInputFieldRef:Z,quickReplySuggestionItems:de}=vt(p);gt(()=>{z(),setTimeout(()=>{var L;(L=Z.value)==null||L.focus()},500)});const z=()=>{axios.get(route("user.conversations.api",{data:"ai_templates"})).then(L=>{p.$patch({aiTemplates:L.data.data})}).catch(L=>console.error(L))};Ie();const ue=L=>{a.openModal({load:L,multiple:!0,caption:["image","video"].includes(L)?"":void 0,button:{text:"Send"},onOpen:()=>{_.value=!1,E.value.type=L},onSelect:C=>{},onSubmit:(C,N)=>{let Q=C.map(ye=>ye.path);if(E.value.file=Q[0]??!1,E.value.caption=N.caption,!E.value.file)return He.warning("Attachment not found, please try again");p.submitMessage()}})},he=()=>{if(E.value.type="text",!E.value.message)return He.warning("Please enter a message");p.submitMessage()};return(L,C)=>{var Q,ye,Te,Me;const N=tt("Icon");return O(),j("div",ri,[W(It),D("div",ni,[(ye=(Q=P(ne))==null?void 0:Q.messages)!=null&&ye.length?(O(),j("ul",ai,[D("li",oi,[W(Tt,{afterIntersection:P(p).loadMoreMessages,loader:P(A).messages},null,8,["afterIntersection","loader"])]),(O(!0),j(bt,null,yt(((Te=P(ne))==null?void 0:Te.messages)??[],(k,Ue)=>{var Be,pe,le,J,we,Re,ke,Ce;return O(),j("li",{class:Ct(["group",{pr:(Be=k==null?void 0:k.key)==null?void 0:Be.fromMe}]),key:Ue},[(pe=k==null?void 0:k.message)!=null&&pe.reactionMessage?Y("",!0):(O(),j("div",si,[(le=k==null?void 0:k.key)!=null&&le.fromMe?Y("",!0):(O(),j("div",di,[D("img",{src:P(p).getConversationProfilePic(P(ne)),class:"avatar-img",alt:"profile-img"},null,8,ui)])),D("div",li,[(we=(J=k.meta)==null?void 0:J.context)!=null&&we.id?(O(),j("p",ci,se((ke=(Re=k.meta)==null?void 0:Re.context)==null?void 0:ke.title),1)):Y("",!0),D("div",fi,[W(Bt,{message:k},null,8,["message"])]),D("div",hi,[D("span",{class:"text-xs font-normal text-slate-400",title:P(Ze).unix(k.messageTimestamp).local().format("D MMM, YYYY h:mm A")},se(P(Ze).unix(k.messageTimestamp).local().format("D MMM, h:mm A")),9,pi),(Ce=k==null?void 0:k.key)!=null&&Ce.fromMe?(O(),j("span",{key:0,class:"font-bolder ml-1 text-slate-300",title:k.status==1?"Pending":k.status==2?"Sent":k.status==3?"Delivered":k.status==4?"Seen":""},[k.status==1?(O(),j("i",vi)):k.status==2?(O(),j("i",gi)):k.status==3?(O(),j("i",bi)):k.status==4?(O(),j("i",yi)):Y("",!0)],8,mi)):Y("",!0)])])]))],2)}),128))])):(O(),j("div",wi,C[16]||(C[16]=[D("p",{class:"text-center italic text-slate-600"},"No messages",-1)])))]),D("div",Ri,[P(p).isReplying?(O(),Ne(_t,{key:0})):Y("",!0),W(Ut),P(E).type==="voice"?(O(),Ne(ii,{key:1,store:P(p)},null,8,["store"])):Y("",!0),Xe(W(Ft,null,null,512),[[wt,P(de).length>0]]),P(E).type!="voice"?(O(),j("form",{key:2,onSubmit:Ge(he,["prevent"]),class:"flex h-[4.2rem] items-center rounded-primary shadow"},[Xe(D("textarea",{ref_key:"messageInputFieldRef",ref:Z,"onUpdate:modelValue":C[0]||(C[0]=k=>P(E).message=k),onKeyup:[C[1]||(C[1]=Pe((...k)=>L.onArrowDown&&L.onArrowDown(...k),["down"])),C[2]||(C[2]=Pe((...k)=>L.onArrowUp&&L.onArrowUp(...k),["up"]))],onKeydown:[C[3]||(C[3]=Pe(Ge((...k)=>L.selectQuickReply&&L.selectQuickReply(...k),["prevent"]),["tab"])),Pe(Ge(he,["exact","prevent"]),["enter"])],disabled:P(A).sendingMessage,class:"max-h-16 min-h-16 w-full border-transparent bg-transparent px-4 text-sm text-slate-700 placeholder:text-slate-500 focus:border-transparent focus:ring-0 dark:text-slate-300 dark:placeholder:text-slate-400",placeholder:"Type message... enter to send, shift+enter to next line"},null,40,ki),[[Rt,P(E).message]]),D("div",xi,[D("button",{type:"button",onClick:C[4]||(C[4]=k=>P(F).open("aiModal")),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[W(N,{icon:"fluent:chat-sparkle-16-regular"})]),D("button",{type:"button",onClick:C[5]||(C[5]=(...k)=>P(p).quickReplyModalOpen&&P(p).quickReplyModalOpen(...k)),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[W(N,{icon:"bxs:layer"})]),D("button",{type:"button",onClick:C[6]||(C[6]=k=>P(F).open("TemplateMessageModal")),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[W(N,{icon:"bxs:grid"})]),(Me=P(p).features)!=null&&Me.voice_message?(O(),j("button",{key:0,type:"button",onClick:C[7]||(C[7]=k=>P(E).type="voice"),class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[W(N,{icon:"bxs:microphone"})])):Y("",!0),D("div",Ci,[D("button",{id:"btn-upload-media",onClick:C[8]||(C[8]=k=>_.value=!P(_)),type:"button",class:"text-slate-500 hover:text-primary-500 focus:text-primary-500 dark:text-slate-400 dark:hover:text-primary-500 dark:focus:text-primary-500"},[W(N,{icon:"bx:link-alt"})]),P(_)?(O(),j("div",{key:0,class:"fixed inset-0 bg-transparent",onClick:C[9]||(C[9]=k=>_.value=!1)})):Y("",!0),W(xt,{name:"fade"},{default:kt(()=>[P(_)?(O(),j("div",Si,[D("button",{type:"button",class:"absolute -right-2 -top-3 rounded-full border border-red-500 bg-white p-1 text-end text-black hover:bg-gray-100 dark:bg-dark-900 dark:text-slate-300 dark:hover:bg-dark-700",onClick:C[10]||(C[10]=k=>_.value=!1)},[W(N,{icon:"bx:x",class:"size-3 text-red-500"})]),D("div",Ti,[D("button",{onClick:C[11]||(C[11]=()=>ue("document")),type:"button",class:"btn btn-dark btn-xs w-full"},[W(N,{icon:"bx:file"}),D("span",null,se(L.trans("Documents")),1)]),D("button",{onClick:C[12]||(C[12]=k=>ue("image")),type:"button",class:"btn btn-dark btn-xs w-full"},[W(N,{icon:"bx:image"}),D("span",null,se(L.trans("Image")),1)]),D("button",{onClick:C[13]||(C[13]=()=>ue("video")),type:"button",class:"btn btn-dark btn-xs w-full"},[W(N,{icon:"bx:video"}),D("span",null,se(L.trans("Video")),1)]),D("button",{onClick:C[14]||(C[14]=()=>ue("audio")),type:"button",class:"btn btn-dark btn-xs w-full"},[W(N,{icon:"bx:microphone"}),D("span",null,se(L.trans("Audio")),1)]),D("button",{onClick:C[15]||(C[15]=()=>P(F).open("locationMessageModal")),type:"button",class:"btn btn-dark btn-xs w-full"},[W(N,{icon:"bx:map"}),D("span",null,se(L.trans("Location")),1)])])])):Y("",!0)]),_:1})]),W(Lt,{icon:"bx:send","btn-text":"",disabled:P(A).sendingMessage},null,8,["disabled"])])],32)):Y("",!0)])])}}};export{zi as default};
