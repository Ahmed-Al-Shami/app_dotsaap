import{$ as h,r as g,p as i,m as w,a0 as b,a as x,c as $,g as k,o as y,d as c,b as C,w as L,t as E}from"./app-BYM_31EU.js";import{e as M}from"./echoServiceComposable-Bzp0fI07.js";const N={key:0,class:"fixed bottom-12 right-12"},S={class:"relative flex h-12 w-12 items-center justify-center rounded-full dark:bg-slate-700"},I={class:"absolute -right-1 -top-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-xs font-normal text-white"},B={__name:"NotificationRing",props:{module:{type:String,default:"whatsapp"}},setup(f){var p,m;const a=((m=(p=h().props.authUser)==null?void 0:p.active_workspace)==null?void 0:m.owner_id)??null,t=f,s=M.connect(),o=g([]),u=i(()=>o.value.length);w(()=>{if(!a)return console.log("Owner id not found");s==null||s.private(`live-chat.${t.module}.${a}`).subscribed(()=>console.log("Live chat counter activated successfully")).listen("LiveChatNotifyEvent",e=>{t.module=="whatsapp"&&d({platform_id:e.platform_id,conversation_id:e.conversation_id,message_id:e.message_id}),t.module=="whatsapp-web"&&e.event=="MESSAGES_UPSERT"&&d({sessionId:e.sessionId})}).error(e=>console.error(e))});const d=e=>{o.value.push(e),v()};b(()=>{s==null||s.leave(`live-chat.${t.module}.${a}`),console.log("Live chat counter left successfully")});const v=()=>{let e="/assets/incoming-message-online-whatsapp.mp3";new Audio(e).play().catch(l=>console.warn("Audio playback error:",l))},n=i(()=>o.value[o.value.length-1]),_=i(()=>{if(t.module==="whatsapp")return`/user/${t.module}/platforms/${n.value.platform_id}/conversations/${n.value.conversation_id}`;if(t.module==="whatsapp-web")return`/user/whatsapp-web/platforms/${n.value.sessionId}/conversations`});return(e,r)=>{const l=x("Link");return u.value>0?(y(),$("div",N,[c("div",S,[C(l,{href:_.value},{default:L(()=>r[0]||(r[0]=[c("img",{src:"/assets/svg/alert-counter.gif",alt:""},null,-1)])),_:1,__:[0]},8,["href"]),c("span",I,E(u.value),1)])])):k("",!0)}}};export{B as _};
