import{c as g,o as p,F as z,i as G,O as W,d as b,P as $,s as E,r as m,p as c,Q as N}from"./app-BYM_31EU.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{h as P}from"./moment-BAtM24Ew.js";const Y={class:"mb-4 grid grid-cols-1 gap-4 lg:grid-cols-4"},H={__name:"OverviewCard",props:{skeletonCount:{type:Number,default:4}},setup(i){return(u,d)=>(p(),g("section",Y,[(p(!0),g(z,null,G(i.skeletonCount,t=>(p(),g("div",{key:t,class:"card animate-pulse"},d[0]||(d[0]=[W('<div class="card-body flex items-center gap-2"><div class="h-10 w-10 rounded-full bg-dark-600 bg-opacity-20 p-3 text-xl dark:bg-dark-300"></div><div class="flex flex-1 flex-col gap-2"><div class="h-3 w-28 rounded bg-dark-300"></div><div class="h-4 w-16 rounded bg-dark-400"></div></div></div>',1)])))),128))]))}},K={},Q={class:"card flex h-[28rem] animate-pulse flex-col justify-between bg-gray-300 p-5"};function R(i,u){return p(),g("div",Q,u[0]||(u[0]=[b("div",{class:"h-6 w-1/3 rounded bg-dark-500"},null,-1),b("div",{class:"h-40 rounded bg-dark-500"},null,-1),b("div",{class:"mx-auto h-6 w-1/4 rounded bg-dark-500"},null,-1)]))}const J=A(K,[["render",R]]),{moduleLabel:x,pickBy:T}=E(),X=$("userDashboard",()=>{const i=m(null),u=m({campaigns:"month",customers:"month",messages:"month"}),d=m(["#3c355b","#2a8f9e","#8b8c99","#6b56a3","#c0392b","#138d29","#2b7ca9"]),t=m({customers:{data:[],loading:!1},campaigns:{data:[],loading:!1},messages:{data:[],loading:!1},overviews:{data:[],loading:!1},schedule_campaigns:{data:[],loading:!1},storage:{data:0,loading:!1},plan_data:{data:0,loading:!1}});function f(a=!0,s="all"){s==="all"?Object.keys(t.value).forEach(e=>{t.value[e].loading=a}):t.value[s].loading=a}async function _({type:a="all",filter:s=null,platform:e=null,user_id:o=null}){f(!0,a),i.value=null;try{const r=T({analytics:a,filter:s,platform:e,user_id:o}),l=await N.get("/api/user/dashboard",{params:r}),{data:n}=l,k={all:()=>{t.value.customers.data=n.customers,t.value.campaigns.data=n.campaigns,t.value.messages.data=n.messages,t.value.overviews.data=n.overviews},customers:()=>{t.value[a].data=n.customers},campaigns:()=>{t.value[a].data=n.campaigns},messages:()=>{t.value[a].data=n.messages},overviews:()=>{t.value[a].data=n.overviews},schedule_campaigns:()=>{t.value[a].data=n.schedule_campaigns},storage:()=>{t.value[a].data=n.storage},plan_data:()=>{t.value[a].data=n.plan_data}}[a];return k&&k(),f(!1,a),n}catch(r){throw f(!1,a),i.value=`Failed to fetch ${a} analytics: ${r.message}`,r}}function h(a){const s=[...new Set(Object.values(a).flatMap(o=>o.map(r=>r.date)))].sort((o,r)=>new Date(o)-new Date(r));return{series:Object.entries(a).map(([o,r])=>{const l=new Map(r.map(n=>[n.date,n.total]));return{name:x(o),data:s.map(n=>l.get(n)||0)}}),dates:s}}function w(a){const s=a.match(/([\d.]+)\s*(GB|MB|KB|B)/i);if(!s)throw new Error("Invalid format. Use a format like '2.00 GB'.");const e=parseFloat(s[1]),o=s[2].toUpperCase(),r={B:1,KB:1024,MB:1024**2,GB:1024**3};return Math.round(e*r[o])}const y=c(()=>Object.keys(t.value).map(a=>({[a]:t.value[a].data}))),B=c(()=>Object.values(t.value).every(a=>a.loading)),O=c(()=>{const{series:a,dates:s}=h(t.value.customers.data);return{series:a,chartOptions:{colors:d.value,chart:{height:400,type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:s},yaxis:{show:!1,opposite:!0,labels:{formatter:function(e){return e.toFixed(0)}}}}}}),C=c(()=>{var r,l,n,v;const a=(r=t.value.storage)==null?void 0:r.data,s=((v=(n=(l=t.value.plan_data)==null?void 0:l.data)==null?void 0:n.storage)==null?void 0:v.value)||1,e=a?w(a):0,o=w(s+".00 GB");return Math.round(e/o*100)}),S=c(()=>{var e,o,r,l;const a=((r=(o=(e=t.value.plan_data)==null?void 0:e.data)==null?void 0:o.storage)==null?void 0:r.value)||"0.00 GB",s=`${(l=t.value.storage)==null?void 0:l.data} / ${a===-1?"Unlimited":a+" GB"}`;return{series:[C.value],chartOptions:{chart:{height:300,type:"radialBar",offsetY:30,toolbar:{show:!1}},plotOptions:{radialBar:{startAngle:-90,endAngle:90,hollow:{size:"60%"},track:{background:"#9ca3af",strokeWidth:"100%",margin:15},dataLabels:{name:{show:!0,offsetY:-20,fontSize:"13px",fontWeight:"500",color:"#9ca3af"},value:{offsetY:-10,fontSize:"14px",fontWeight:"bold",color:"#9ca3af",formatter:()=>s??"Loading..."}}}},colors:["#6E43D4"],fill:{type:"solid",colors:["#1daa61"]},stroke:{lineCap:"round"},labels:["Storage Usage"]}}}),F=c(()=>{var e;const{series:a,dates:s}=h((e=t.value.campaigns)==null?void 0:e.data);return{series:a,chartOptions:{colors:d.value,chart:{height:400,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:s},yaxis:{show:!1,opposite:!0,labels:{formatter:function(o){return o.toFixed(0)}}}}}}),D=c(()=>{var e;const{series:a,dates:s}=h((e=t.value.messages)==null?void 0:e.data);return{series:a,chartOptions:{colors:d.value,chart:{height:400,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:s},yaxis:{show:!1,opposite:!0,labels:{formatter:function(o){return o.toFixed(0)}}}}}}),M=c(()=>{var s;const a=Object.entries((s=t.value.messages)==null?void 0:s.data).map(([e,o])=>{const r=o.reduce((l,n)=>l+n.total,0);return{name:x(e),value:r}});return{series:a.map(e=>e.value),chartOptions:{chart:{type:"donut"},colors:d.value,height:160,labels:a.map(e=>e.name),responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]}}}),j=c(()=>{var e;const a=Object.entries((e=t.value.messages)==null?void 0:e.data).map(([o,r])=>({name:o,value:r.reduce((l,n)=>l+n.total,0)})),s=a.reduce((o,r)=>o+r.value,0);return a.map(o=>({name:x(o.name),value:s>0?Number((o.value/s*100).toFixed(2)):0}))}),L=c(()=>{const a=[],s=new Date;for(let e=0;e<7;e++)a.push(P(s).add(e,"days").format("D"));return a}),U=m(["day","week","month","year"]);return{analytics:t,error:i,filterForm:u,dateFilterQueries:U,chartColors:d,loading:B,fetchAnalytics:_,growthChart:O,campaignChart:F,messageChart:D,pieChart:M,storageChart:S,calculatePlatformPercentages:j,currentWeekDays:L,analyticsData:y}});export{J as C,H as _,X as u};
