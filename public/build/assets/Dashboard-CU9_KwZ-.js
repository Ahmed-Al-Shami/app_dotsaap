import{G as J,s as H,k as z,m as b,H as Y,d as K,I as X,q as Z,r as Q,y as ee,c as i,o as n,e as h,a as e,u as t,F as f,g as v,n as T,b as S,t as l,i as F,l as N,A as R,h as I,J as q,w as B}from"./app-TXcSdSht.js";import{_ as U}from"./NoDataFound-CX4SY3HL.js";import{_ as se}from"./AdminLayout-CGy25mJj.js";import{C as L,_ as V}from"./DetailCard-aIeObYIf.js";import{_ as ae}from"./OverviewCard-Bv4Pdi8Y.js";import{m as E}from"./vue3-apexcharts-c5XWL7Vb.js";import"./AssetModal-mZh6fxZu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./InputFieldError-CJFZsvPb.js";import"./ToastrContainer-CicGnxfz.js";const{moduleLabel:te,pickBy:le}=H(),ne=J("adminDashboard",()=>{const x=z(null),y=z({campaigns:"month",customers:"month",messages:"month",plan:"",sales:"month"}),w=z(["#66618e","#42b6c9","#9575cd","#f64f59","#1bc943","#36a2eb","#ff6384","#ff9f40"]),r=z({customers:{data:[],loading:!1},campaigns:{data:[],loading:!1},messages:{data:[],loading:!1},overviews:{data:[],loading:!1},mostOrderedPlan:{data:{},loading:!1},recentOrders:{data:[],loading:!1},sales:{data:[],loading:!1},popularPlans:{data:[],loading:!1}});function m(s=!0,o="all"){o==="all"?Object.keys(r.value).forEach(u=>{r.value[u].loading=s}):r.value[o].loading=s}async function $({type:s="all",filter:o=null,platform:u=null}){m(!0,s),x.value=null;try{const d=le({analytics:s,filter:o,platform:u}),g=await Y.get("/api/admin/dashboard",{params:d}),{data:c}=g,j={all:()=>{r.value.customers.data=c.customers,r.value.campaigns.data=c.campaigns,r.value.messages.data=c.messages,r.value.overviews.data=c.overviews,r.value.mostOrderedPlan.data=c.most_ordered_plan,r.value.recentOrders.data=c.recent_orders,r.value.popularPlans.data=c.popular_plans,r.value.sales.data=c.sales},customers:()=>{r.value[s].data=c.customers},campaigns:()=>{r.value[s].data=c.campaigns},messages:()=>{r.value[s].data=c.messages},overviews:()=>{r.value[s].data=c.overviews},mostOrderedPlan:()=>{r.value[s].data=c.most_ordered_plan},recentOrders:()=>{r.value[s].data=c.recent_orders},sales:()=>{r.value[s].data=c.sales}}[s];return j&&j(),setTimeout(()=>{m(!1,s)},1e3),c}catch(d){throw x.value=`Failed to fetch ${s} analytics: ${d.message}`,d}}function O(s){const o=[...new Set(Object.values(s).flatMap(d=>d.map(g=>g.date)))].sort((d,g)=>new Date(d)-new Date(g));return{series:Object.entries(s).map(([d,g])=>{const c=new Map(g.map(_=>[_.date,_.total]));return{name:te(d),data:o.map(_=>c.get(_)||0)}}),dates:o}}const A=b(()=>Object.keys(r.value).map(s=>({[s]:r.value[s].data}))),D=b(()=>Object.values(r.value).every(s=>s.loading)),p=b(()=>{const{series:s,dates:o}=O(r.value.customers.data);return{series:s,chartOptions:{colors:w.value,chart:{height:350,type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:o},yaxis:{show:!1,opposite:!0,labels:{formatter:function(u){return u.toFixed(0)}}}}}}),P=b(()=>({series:[{name:"Sales",data:r.value.sales.data.map(s=>{const o=Number(s.sales);return isNaN(o)?0:o})}],chartOptions:{colors:w.value,chart:{type:"area",toolbar:{show:!1},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"category",categories:r.value.sales.data.map(s=>String(s.date))}}})),G=b(()=>{var u;const{series:s,dates:o}=O((u=r.value.campaigns)==null?void 0:u.data);return{series:s,chartOptions:{colors:w.value,chart:{height:350,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:o},yaxis:{show:!1,opposite:!0,labels:{formatter:function(d){return d.toFixed(0)}}}}}}),k=b(()=>{var u;const{series:s,dates:o}=O((u=r.value.messages)==null?void 0:u.data);return{series:s,chartOptions:{colors:w.value,chart:{height:400,type:"bar",toolbar:{show:!1},zoom:{enabled:!1}},plotOptions:{bar:{borderRadius:3,columnWidth:"12px"}},dataLabels:{enabled:!1},stroke:{curve:"smooth"},xaxis:{type:"string",categories:o},yaxis:{show:!1,opposite:!0,labels:{formatter:function(d){return d.toFixed(0)}}}}}}),M=b(()=>{const s=r.value.popularPlans.data||[],o=s.reduce((u,d)=>u+Number(d.orders_count),0);return s.map(u=>{const d=o?Number(u.orders_count)/o*100:0;return{...u,percentage:d}})}),W=z(["day","week","month","year"]);return{analytics:r,error:x,filterForm:y,dateFilterQueries:W,chartColors:w,loading:D,mostOrderedPlan:b(()=>r.value.mostOrderedPlan.data),fetchAnalytics:$,growthChart:p,campaignChart:G,messageChart:k,salesChart:P,analyticsData:A,plansWithPercentage:M}}),oe={class:"space-y-6"},re={key:1,class:"mb-4 grid grid-cols-1 gap-4 xl:grid-cols-4"},ie={class:"flex items-center gap-3 p-5"},de={class:"flex flex-1 flex-col"},ce={class:"text-sm tracking-wide text-slate-500"},ue={class:"grid grid-cols-1 gap-6 xl:grid-cols-2"},pe={key:1,class:"card rounded-2xl p-5"},me={class:"flex flex-wrap justify-between gap-2"},he={value:"",selected:""},fe=["value","selected"],ve={key:3,class:"card rounded-2xl p-5"},ge={class:"flex flex-wrap justify-between gap-2"},ye={value:"",selected:""},_e=["value","selected"],be={class:"grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3"},xe={class:"order-2 col-span-1 md:col-span-2 xl:order-3"},we={key:1,class:"card-body card flex h-full flex-col justify-between gap-4 rounded-2xl"},ke={class:"flex flex-wrap justify-between gap-2"},Ce={value:"",selected:""},Oe=["value","selected"],Pe={class:"order-4 col-span-full space-y-6 xl:col-span-1"},Se={class:"card card-body flex items-center justify-between gap-2 rounded-2xl"},je={key:0,class:"flex items-center gap-2"},ze={class:"badge badge-success"},Fe={key:1,class:"flex items-center gap-2"},$e={class:"badge badge-danger"},Ae={key:1,class:"card card-body rounded-2xl"},De={class:"styled-scrollbar mt-3 max-h-[21rem] space-y-3 overflow-y-auto"},Me={class:"mb-1 flex justify-between"},Ne={class:"font-medium"},Be=["title"],Ue={class:"mb-1 flex justify-between"},Ve={class:"font-medium"},We=["title"],Te={key:3,class:"grid grid-cols-12 place-items-start gap-6"},Re={class:"card-body card col-span-8 space-y-2 rounded-2xl"},Ie={key:0,class:"table-responsive whitespace-nowrap rounded-primary"},Le={class:"table min-w-[43rem]"},Ee={class:"whitespace-nowrap"},Ge={class:"whitespace-nowrap"},Qe={class:"whitespace-nowrap"},qe={class:"card-body card col-span-4 flex h-full flex-col rounded-2xl"},He={key:0,class:"mt-auto divide-y dark:divide-slate-600"},Je={class:"flex items-center gap-4 py-2"},Ye={class:"flex h-12 w-12 min-w-12 items-center justify-center"},Ke=["src"],Xe={class:"flex w-full items-center justify-between"},Ze={class:"text-sm font-medium text-slate-600 dark:text-slate-300"},es={class:"text-sm text-slate-400"},ss={class:"text-xs text-slate-200"},as={class:"text-sm font-medium text-slate-600 dark:text-slate-300"},ts={class:"text-sm text-slate-400"},ls={class:"grid grid-cols-3 place-items-start gap-6"},ns={class:"card-body card col-span-2 rounded-2xl"},os={class:"table-responsive whitespace-nowrap rounded-primary"},rs={class:"table"},is={class:"text-primary-500"},ds={class:"card-body card col-span-1 w-full rounded-2xl"},cs={class:"flex flex-wrap items-center justify-between"},us={class:"flex items-center gap-2"},ps=["onClick"],ms={key:0,class:"text-sm text-slate-200 dark:text-slate-600"},hs={key:1,class:"mt-4 flex items-center gap-4 rounded-primary bg-slate-50 p-4 dark:bg-slate-900"},fs={class:"flex flex-1 flex-col gap-1"},vs={class:"text-sm font-semibold"},gs={class:"text-sm text-slate-500 dark:text-slate-400"},ys=K({layout:se}),zs=Object.assign(ys,{__name:"Dashboard",props:["popularPlans","recentCreditLogs","isWaServerActive"],setup(x){const y=ne(),{textExcerpt:w,formatCurrency:r}=H(),{analytics:m,growthChart:$,campaignChart:O,salesChart:A,dateFilterQueries:D,filterForm:p,chartColors:P,loading:G,mostOrderedPlan:k,plansWithPercentage:M}=X(y);Z(()=>{y.fetchAnalytics("all","month")});const W=[{label:"Today",value:"today"},{label:"Month",value:"month"},{label:"All",value:""}];return(s,o)=>{var c,_,j;const u=Q("Icon"),d=Q("Link"),g=ee("lazy");return n(),i("div",oe,[t(m).overviews.loading?(n(),h(ae,{key:0,"skeleton-count":8})):(n(),i("section",re,[(n(!0),i(f,null,v(t(m).overviews.data,(a,C)=>(n(),i("div",{key:C,class:"card rounded-2xl"},[e("div",ie,[e("div",{class:T(["flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-xl bg-opacity-10",a.style])},[S(u,{icon:a.icon,class:"text-2xl"},null,8,["icon"])],2),e("div",de,[e("p",ce,l(s.trans(a.title)),1),e("h5",null,l(a.value),1)])])]))),128))])),e("div",ue,[t(m).customers.loading?(n(),h(L,{key:0})):(n(),i("div",pe,[e("div",me,[e("h6",null,l(s.trans("Customer Statistic")),1),N(e("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>t(p).customers=a),onChange:o[1]||(o[1]=a=>t(y).fetchAnalytics({type:"customers",filter:t(p).customers})),class:"select select-xl w-full capitalize md:w-40"},[e("option",he,l(s.trans("Filter By")),1),(n(!0),i(f,null,v(t(D),a=>(n(),i("option",{value:a,key:a,selected:t(p).sales===a},l(a),9,fe))),128))],544),[[R,t(p).customers]])]),s.$el?(n(),h(t(E),{key:0,height:"350",options:t($).chartOptions,series:t($).series},null,8,["options","series"])):F("",!0)])),t(m).campaigns.loading?(n(),h(L,{key:2})):(n(),i("div",ve,[e("div",ge,[e("h6",null,l(s.trans("Campaign Statistic")),1),N(e("select",{"onUpdate:modelValue":o[2]||(o[2]=a=>t(p).campaigns=a),onChange:o[3]||(o[3]=a=>t(y).fetchAnalytics({type:"campaigns",filter:t(p).campaigns})),class:"select select-xl w-full capitalize md:w-40"},[e("option",ye,l(s.trans("Filter By")),1),(n(!0),i(f,null,v(t(D),a=>(n(),i("option",{value:a,key:a,selected:t(p).sales===a},l(a),9,_e))),128))],544),[[R,t(p).campaigns]])]),s.$el?(n(),h(t(E),{key:0,height:"350",options:t(O).chartOptions,series:t(O).series},null,8,["options","series"])):F("",!0)]))]),e("section",be,[e("div",xe,[t(m).sales.loading?(n(),h(L,{key:0})):(n(),i("div",we,[e("div",ke,[e("h6",null,l(s.trans("Overview Of Sales")),1),N(e("select",{"onUpdate:modelValue":o[4]||(o[4]=a=>t(p).sales=a),onChange:o[5]||(o[5]=a=>t(y).fetchAnalytics({type:"sales",filter:t(p).sales})),class:"select select-xl w-full capitalize md:w-40"},[e("option",Ce,l(s.trans("Filter By")),1),(n(),i(f,null,v(["day","week","month","year"],a=>e("option",{value:a,key:a,selected:t(p).sales===a},l(a),9,Oe)),64))],544),[[R,t(p).sales]])]),e("div",null,[s.$el?(n(),h(t(E),{type:"area",height:"400",options:t(A).chartOptions,series:t(A).series,key:"salesChart"},null,8,["options","series"])):F("",!0)])]))]),e("div",Pe,[e("div",Se,[I(l(s.trans("Whatsapp Server Status"))+": ",1),x.isWaServerActive?(n(),i("div",je,[o[6]||(o[6]=e("span",{class:"relative flex size-4 items-center justify-center"},[e("span",{class:"absolute inline-flex h-full w-full animate-ping rounded-full bg-success-400 opacity-75"}),e("span",{class:"relative inline-flex size-3 rounded-full bg-success-600"})],-1)),e("span",ze,l(s.trans("Connected")),1)])):(n(),i("div",Fe,[o[7]||(o[7]=e("span",{class:"relative flex size-4 items-center justify-center"},[e("span",{class:"absolute inline-flex h-full w-full animate-ping rounded-full bg-danger-400 opacity-75"}),e("span",{class:"relative inline-flex size-3 rounded-full bg-danger-600"})],-1)),e("span",$e,l(s.trans("Disconnected")),1)]))]),t(m).popularPlans.loading?(n(),i(f,{key:0},[S(V),S(V)],64)):(n(),i("div",Ae,[e("h6",null,l(s.trans("Popular Plans")),1),e("div",De,[(n(!0),i(f,null,v(t(M),(a,C)=>(n(),i("div",{key:a.name},[e("div",Me,[e("span",Ne,l(a.name),1)]),e("div",{class:"h-2 w-full rounded-lg bg-gray-200",title:Math.round(a.percentage)},[e("div",{class:"h-full rounded-lg transition-all",style:q({width:a.percentage+"%",backgroundColor:t(P)[C%t(P).length]})},null,4)],8,Be)]))),128)),(n(!0),i(f,null,v(t(M),(a,C)=>(n(),i("div",{key:a.name},[e("div",Ue,[e("span",Ve,l(a.name),1)]),e("div",{class:"h-2 w-full rounded-lg bg-gray-200",title:Math.round(a.percentage)},[e("div",{class:"h-full rounded-lg transition-all",style:q({width:a.percentage+"%",backgroundColor:t(P)[C%t(P).length]})},null,4)],8,We)]))),128))])]))])]),t(m).popularPlans.loading?(n(),h(V,{key:2})):(n(),i("section",Te,[e("div",Re,[e("h6",null,l(s.trans("Popular Plans")),1),((c=t(m).popularPlans.data)==null?void 0:c.length)>0?(n(),i("div",Ie,[e("table",Le,[e("thead",null,[e("tr",null,[e("th",null,l(s.trans("Plan")),1),e("th",null,l(s.trans("Active Users")),1),e("th",null,l(s.trans("Sales")),1),e("th",null,l(s.trans("Total Amount")),1)])]),e("tbody",null,[(n(!0),i(f,null,v(t(m).popularPlans.data,a=>(n(),i("tr",{key:a.id},[e("td",Ee,[S(d,{href:s.route("admin.plan.index")},{default:B(()=>[I(l(a.name),1)]),_:2},1032,["href"])]),e("td",Ge,l(a.activeuser),1),e("td",Qe,[e("p",null,l(a.orders_count),1)]),e("td",null,l(a.total_amount),1)]))),128))])])])):(n(),h(U,{key:1}))]),e("div",qe,[e("h6",null,l(s.trans("Recent Orders")),1),((_=t(m).recentOrders.data)==null?void 0:_.length)>0?(n(),i("div",He,[(n(!0),i(f,null,v(t(m).recentOrders.data,a=>(n(),h(d,{key:a.id,href:s.route("admin.order.index")},{default:B(()=>[e("div",Je,[e("div",Ye,[N(e("img",{src:a.avatar,class:"rounded-primary",alt:"avatar"},null,8,Ke),[[g,a.avatar==null?`https://ui-avatars.com/api/?name=${a==null?void 0:a.name}`:`${a.avatar}`]])]),e("div",Xe,[e("div",null,[e("h6",Ze,l(a.invoice),1),e("p",es,l(a.plan),1),e("p",ss,"By "+l(a.name),1)]),e("div",null,[e("h6",as,l(a.amount),1),e("p",ts,l(a.created_at),1)])])])]),_:2},1032,["href"]))),128))])):(n(),h(U,{key:1}))])])),e("section",ls,[e("div",ns,[e("h6",null,l(s.trans("Recent Credits")),1),e("div",os,[e("table",rs,[e("thead",null,[e("tr",null,[e("th",null,l(s.trans("Invoice")),1),e("th",null,l(s.trans("User Name")),1),e("th",null,l(s.trans("Credits")),1),e("th",null,l(s.trans("Price")),1),e("th",null,l(s.trans("Status")),1),e("th",null,l(s.trans("Gateway")),1)])]),e("tbody",null,[(n(!0),i(f,null,v(x.recentCreditLogs,a=>(n(),i("tr",{key:a.id},[e("td",null,[e("p",is,l(a.invoice_no),1)]),e("td",null,[S(d,{href:s.route("admin.users.show",a.user_id)},{default:B(()=>[I(l(t(w)(a.user.name,30)),1)]),_:2},1032,["href"])]),e("td",null,l(a.credits),1),e("td",null,l(t(r)(a.price)),1),e("td",null,[e("span",{class:T(a.status==1?"badge badge-success":"badge badge-warning")},l(a.status==1?"Complete":"Pending"),3)]),e("td",null,l(a.gateway.name),1)]))),128))]),x.recentCreditLogs.length==0?(n(),h(U,{key:0,"for-table":!0})):F("",!0)])])]),e("div",ds,[e("div",cs,[e("h6",null,l(s.trans("Most Ordered Plan")),1),e("div",us,[(n(),i(f,null,v(W,(a,C)=>(n(),i(f,{key:a.label},[e("button",{type:"button",onClick:()=>{t(p).plan=a.value,t(y).fetchAnalytics({type:"mostOrderedPlan",filter:t(p).plan})}},[e("span",{class:T(["text-xs capitalize",{"font-medium text-primary-500":t(p).plan==a.value}])},l(s.trans(a.label)),3)],8,ps),C<2?(n(),i("span",ms,"|")):F("",!0)],64))),64))])]),t(m).mostOrderedPlan.loading?(n(),h(V,{key:0,classes:"m-0 h-24 p-0"})):((j=Object.keys(t(k)))==null?void 0:j.length)>0&&!t(m).mostOrderedPlan.loading?(n(),i("div",hs,[S(d,{href:s.route("admin.plan.index")},{default:B(()=>[e("div",fs,[e("h3",vs,l(t(k).title),1),e("p",gs,l(s.trans("Price"))+": "+l(t(r)(t(k).price))+", "+l(t(k).days==30?"Monthly":"Yearly")+", "+l(s.trans("Total Order"))+": "+l(t(k).orders_count),1)])]),_:1},8,["href"])])):(n(),h(U,{key:2}))])])])}}});export{zs as default};
